(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{39:function(e,t,n){},40:function(e,t,n){},45:function(e,t){},75:function(e,t){},83:function(e,t,n){"use strict";n.r(t);n(39),n(40);var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function c(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var a=n(3),i=n(0);function s(e){var t=e.children;return Object(i.jsx)("div",{className:"p-4",children:t})}function o(e){var t=e.children;return Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{children:t}),Object(i.jsx)("div",{children:"ok2"})]})}var u,l=n(4),d=n(86),j=n(21),b=n(22),p=n(7),f=n.n(p),m=n(12),h=n(8),v=n(16),O=n(17),g=function(){function e(t,n){Object(j.a)(this,e),this.secret=t,this.storage=n}return Object(b.a)(e,[{key:"encrypt",value:function(e,t){if("object"===typeof t)t=JSON.stringify(t);else if("number"===typeof t)t=t.toString();else if("string"!==typeof t)throw new Error("invalid type");var n=O.AES.encrypt(t,this.secret);return this.storage.setItem(e,n.toString())}},{key:"decrypt",value:function(){var e=Object(m.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getItem(t);case 2:if(n=e.sent,r=null,n){r=O.AES.decrypt(n,this.secret).toString(O.enc.Utf8);try{r=JSON.parse(r)}catch(c){}}return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(e){return this.storage.removeItem(e)}}]),e}();function x(e){return u?u.decrypt(e):null}function y(e,t){if(!u)throw"Pin not set";return u.encrypt(e,t)}function w(e){u=new g(e,v)}window.localforage=v;var k,N=n(5),E=Object(h.a)({contacts:[]});function C(){return(C=Object(m.a)(f.a.mark((function e(t){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x("contacts");case 2:if(n=e.sent,!Object(N.isEmpty)(n)){e.next=5;break}return e.abrupt("return");case 5:return n=n.filter((function(e){return e.publicKey!==t.publicKey})),void 0!==(r=E.contacts.findIndex((function(e){return e.publicKey.get()===t.publicKey})))&&E.contacts[r].set(h.b),e.next=10,y("contacts",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=2;break}return e.abrupt("return",E);case 2:return k=!0,e.next=5,x("contacts");case 5:return t=(t=e.sent).map((function(e){return new P(e)})),E.merge({contacts:t}),e.abrupt("return",E);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=function(){function e(t){var n=t.id,r=t.name,c=t.emailHash,a=t.publicKey;Object(j.a)(this,e),this.id=n,this.name=r,this.emailHash=c,this.publicKey=a}return Object(b.a)(e,[{key:"save",value:function(){return e=this,void x("contacts").then((function(t){Object(N.isEmpty)(t)&&(t=[]);var n=t.find((function(t){return t.publicKey===e.publicKey}));n?(Object.assign(n,e.serializeWithoutId()),E.contacts.find((function(t){return t.publicKey.get()===e.publicKey})).merge(e.serializeWithoutId())):(E.contacts.merge([e]),t.push(e.serialize())),y("contacts",t)}));var e}},{key:"destroy",value:function(){return function(e){return C.apply(this,arguments)}(this)}},{key:"serialize",value:function(){return{emailHash:this.emailHash,id:this.id,name:this.name,publicKey:this.publicKey}}},{key:"serializeWithoutId",value:function(){var e=this.serialize();return delete e.id,e}}]),e}();var V=n(1),K=n.n(V),I=n(38);function M(e){var t=e.isOpened,n=e.close,r=e.children;Object(V.useEffect)((function(){return t?document.body.classList.add("overflow-y-hidden"):document.body.classList.remove("overflow-y-hidden")}),[t]);var c=Object(V.useRef)(null);return Object(I.a)(c,n),t?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-70"}),Object(i.jsx)("div",{className:"absolute inset-0 items-center py-20 overflow-y-auto",children:Object(i.jsx)("div",{className:"mb-20 bg-white w-1/3 p-4 rounded shadow mx-auto",ref:c,children:r})})]}):null}function T(){var e=Object(h.c)({inputPkNameEmail:"",modalOpened:!1});return Object(i.jsxs)("div",{children:[Object(i.jsx)("button",{className:"bg-black text-white p-3",onClick:function(t){t.preventDefault(),e.merge({modalOpened:!0})},children:"+ Add new contact"}),Object(i.jsx)(M,{isOpened:e.modalOpened.get(),close:function(){e.merge({modalOpened:!1})},children:Object(i.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(t){t.preventDefault(),function(e){var t=e.replace(/\s/g,"").split("."),n=Object(l.a)(t,3),r=n[0],c=n[1],a=n[2];c=atob(c),new P({emailHash:a,id:Object(d.a)(),name:c,publicKey:r}).save()}(e.inputPkNameEmail.get()),e.merge({inputPkNameEmail:"",modalOpened:!1})},children:Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("legend",{children:"Contact public key, name and email hashed"}),Object(i.jsx)("div",{className:"pure-control-group",children:Object(i.jsx)("input",{name:"inputPkNameEmail",value:e.inputPkNameEmail.get(),onChange:function(t){var n=t.target.value;e.merge({inputPkNameEmail:n})},placeholder:"Paste the contact code",className:"w-full"})}),Object(i.jsx)("button",{type:"submit",className:"pure-button pure-button-primary bg-black w-full",disabled:Object(N.isEmpty)(e.inputPkNameEmail.get()),children:"Add"})]})})})]})}var A,W=n(87);function D(e){var t=Object(V.useState)(),n=Object(l.a)(t,2),r=n[0],c=n[1];Object(V.useEffect)((function(){v.getItem(e).then((function(e){c(e)}))}),[c,e]);return[r,function(t){c(t),v.setItem(e,t)}]}function z(){return(z=Object(m.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(N.isEmpty)(A)){e.next=2;break}return e.abrupt("return",A);case 2:return e.next=4,x("key-pair");case 4:if(t=e.sent,!Object(N.isEmpty)(t)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",A=Uint8Array.from(t.publicKey));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){var e=Object(V.useState)(),t=Object(l.a)(e,2),n=t[0],r=t[1];return Object(V.useEffect)((function(){(function(){return z.apply(this,arguments)})().then((function(e){r(e)}))})),n}function L(){var e=Object(a.f)(),t=Object(a.g)(),n=F(),r=D("pk-initialized"),c=Object(l.a)(r,1)[0],i=Object(V.useState)(!1),s=Object(l.a)(i,2),o=s[0],d=s[1],j=Object(W.a)(12e4);return Object(V.useEffect)((function(){if(void 0!==c)return null===c||n?d(!0):void setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50)}),[c,e,n,t,d,t.pathname]),Object(V.useEffect)((function(){n&&j&&(u=null,setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50))}),[j,n,e,t.pathname]),o}var U=n(11);function H(e){var t=e.contact;return Object(i.jsxs)("div",{className:"flex flex-wrap justify-between p-2 bg-gray-300 my-2 rounded",children:[Object(i.jsx)("div",{children:Object(i.jsx)(U.b,{to:"/contacts/".concat(t.id.get()),children:t.name.get()})}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:function(e){e.preventDefault(),t.get().destroy()},children:"Remove"})})]})}function B(){var e=Object(h.c)(E);return Object(i.jsx)(i.Fragment,{children:e.contacts.map((function(e){return Object(i.jsx)(H,{contact:e},e.id.get())}))})}function J(e){var t=e.children,n=Object(V.useState)(),r=Object(l.a)(n,2),c=r[0],a=r[1];return Object(V.useEffect)((function(){(function(){return S.apply(this,arguments)})().then((function(e){a(e)}))}),[a]),c?t:null}function R(e){var t=e.children,n=L();return Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{children:t}),n&&Object(i.jsxs)("div",{className:"w-full md:w-1/3 mx-auto pt-4",children:[Object(i.jsx)("h1",{className:"text-center text-2xl font-bold",children:"Contacts"}),Object(i.jsx)("div",{className:"flex justify-end",children:Object(i.jsx)(T,{})}),Object(i.jsx)("div",{children:Object(i.jsx)(J,{children:Object(i.jsx)(B,{})})})]})]})}var q=n(35);var G=n(36);function $(e){var t=e.children,n=D("pk-initialized"),r=Object(l.a)(n,2),c=r[0],a=r[1],s=Object(h.c)({confirmMatch:!0,confirmPinValue:"",emailValue:"",nameValue:"",passwordStrength:"Too weak",pinValue:"",setupPinModal:!1});var o=Object(N.isEmpty)(s.pinValue.get())||"Too weak"===s.passwordStrength.get()||Object(N.isEmpty)(s.confirmPinValue.get())||!s.confirmMatch.get();return c?t:Object(i.jsxs)("div",{children:[Object(i.jsx)("button",{onClick:function(e){e.preventDefault(),s.merge({setupPinModal:!0})},children:"Get started"}),Object(i.jsx)(M,{isOpened:s.setupPinModal.get(),close:function(e){e.preventDefault(),s.merge({setupPinModal:!1})},children:Object(i.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault();var t=q.box.keyPair();w(s.pinValue.get()),y("key-pair",{publicKey:Array.from(t.publicKey),secretKey:Array.from(t.secretKey)}),y("name",s.nameValue.get()),y("email",s.emailValue.get().toLowerCase().replace(/\s/g,"")),a(!0)},children:Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("legend",{children:"PIN setup"}),Object(i.jsx)("div",{className:"pure-control-group",children:Object(i.jsx)("input",{name:"name",value:s.nameValue.get(),onChange:function(e){s.merge({nameValue:e.target.value})},placeholder:"Enter your name",className:"w-full"})}),Object(i.jsx)("div",{className:"pure-control-group",children:Object(i.jsx)("input",{type:"email",name:"email",value:s.emailValue.get(),onChange:function(e){s.merge({emailValue:e.target.value})},placeholder:"Enter email(to have a avatar)",className:"w-full"})}),Object(i.jsxs)("div",{className:"pure-control-group",children:[Object(i.jsx)("input",{name:"pin",value:s.pinValue.get(),onChange:function(e){var t=e.target.value,n=Object(G.passwordStrength)(t).value;s.merge({passwordStrength:n,pinValue:e.target.value})},placeholder:"Enter new PIN",className:"w-full",required:!0}),Object(i.jsx)("span",{className:"pure-form-message",children:s.passwordStrength.get()})]}),Object(i.jsxs)("div",{className:"pure-control-group",children:[Object(i.jsx)("input",{name:"pinConfirm",value:s.confirmPinValue.get(),onChange:function(e){var t=e.target.value;s.merge((function(e){return{confirmMatch:t===e.pinValue,confirmPinValue:t}}))},placeholder:"Confirm your pin",className:"w-full",required:!0}),!s.confirmMatch.get()&&Object(i.jsx)("span",{className:"pure-form-message",children:"Pins don't match"})]}),Object(i.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:o,children:"Submit"})]})})})]})}var Q=n(23);function X(e){var t,n;return function(e,t){for(var n=Math.ceil(e.length/t),r=Array(n),c=0,a=0;a<n;a++)r[a]=e.substr(c,t),c+=t;return r}(e,Math.ceil((t=3,n=e.length-4,(Math.floor(Math.random()*(n-t+1))+t)/6))).join(" ")}function Y(e){var t=Object(V.useState)(),n=Object(l.a)(t,2),r=n[0],c=n[1];Object(V.useEffect)((function(){x(e).then((function(e){c(e)}))}),[c,e]);return[r,function(t){c(t),y(e,t)}]}function Z(){var e,t=function(e){if(!Object(N.isEmpty)(e))return Object(Q.encodeBase64)(e)}(F()),n=Y("name"),r=Object(l.a)(n,1)[0],c=Y("email"),a=Object(l.a)(c,1)[0],s=r?Object(Q.encodeBase64)((e=r,(new TextEncoder).encode(e))):"",o=a?function(e){return Object(O.MD5)(e).toString()}(a):"",u="".concat(t,".").concat(s,".").concat(o),d=Object(h.c)({showCopied:!1});if(!t)return null;return Object(i.jsx)("div",{className:"p-3",children:Object(i.jsxs)("button",{className:"text-center bg-gray-300 hover:bg-gray-200 rounded p-2 border border-solid border-gray-300",onClick:function(e){e.preventDefault(),function(e){var t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select();var n=document.execCommand("copy");document.body.removeChild(t)}(X(u)),d.merge({showCopied:!0}),setTimeout((function(){d.merge({showCopied:!1})}),1500)},children:[Object(i.jsx)("div",{className:"font-bold",children:"My public key, name and email hashed"}),Object(i.jsx)("div",{children:d.showCopied.get()?"Copied":u}),Object(i.jsx)("div",{className:"text-right text-sm",children:"Click to copy"})]})})}function _(e){var t=e.children,n=L();return Object(i.jsxs)(i.Fragment,{children:[t,n&&Object(i.jsx)($,{children:Object(i.jsx)("div",{className:"w-full md:w-1/3 flex justify-center mx-auto",children:Object(i.jsx)(Z,{})})})]})}var ee=n.p+"static/media/enigma-logo.d8f45653.jpg";function te(){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"flex justify-center",children:Object(i.jsx)("img",{src:ee,alt:"enigma"})}),Object(i.jsxs)("div",{className:"flex flex-wrap justify-center",children:[Object(i.jsx)(ne,{text:"Home",to:"/"}),Object(i.jsx)(ne,{text:"Contacts",to:"/contacts"})]})]})}function ne(e){var t=e.text,n=e.to;return Object(i.jsx)(U.b,{to:n,children:Object(i.jsx)("button",{className:"mx-1 text-center bg-black p-2 rounded text-white",children:t})})}function re(e){var t=e.children;return Object(i.jsx)(U.a,{children:t})}function ce(){var e=Object(h.c)({pinValue:"",showError:!1}),t=Object(a.f)(),n=new URLSearchParams(Object(a.g)().search);function r(){return(r=Object(m.a)(f.a.mark((function r(c){var a,i;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c.preventDefault(),a=n.get("redirectTo"),w(e.pinValue.get()),r.prev=3,r.next=6,x("key-pair");case 6:if(i=r.sent,!Object(N.isEmpty)(i)){r.next=9;break}return r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 9:e.merge({pinValue:"",showError:!1}),setTimeout((function(){t.push(a)}),50),r.next=16;break;case 13:return r.prev=13,r.t0=r.catch(3),r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 16:case"end":return r.stop()}}),r,null,[[3,13]])})))).apply(this,arguments)}return Object(i.jsxs)("div",{className:"w-full md:w-1/3 mx-auto",children:[Object(i.jsx)("div",{className:"flex justify-center",children:Object(i.jsx)("img",{src:ee,alt:"enigma"})}),Object(i.jsx)("form",{className:"pure-form",onSubmit:function(e){return r.apply(this,arguments)},children:Object(i.jsxs)("fieldset",{children:[Object(i.jsxs)("div",{className:"pure-control-group pb-4",children:[Object(i.jsx)("input",{type:"password",value:e.pinValue.get(),onChange:function(t){var n=t.target.value;e.merge({pinValue:n})},className:"w-full",placeholder:"Enter your PIN to continue"}),e.showError.get()&&Object(i.jsx)("span",{className:"pure-form-message text-red-500",children:"Invalid PIN"})]}),Object(i.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:Object(N.isEmpty)(e.pinValue.get()),children:"Unlock"})]})})]})}function ae(){return Object(i.jsx)(re,{children:Object(i.jsx)(s,{children:Object(i.jsxs)(a.c,{children:[Object(i.jsx)(a.a,{path:"/",exact:!0,children:Object(i.jsx)(_,{children:Object(i.jsx)(te,{})})}),Object(i.jsx)(a.a,{path:"/unlock",children:Object(i.jsx)(ce,{})}),Object(i.jsx)(a.a,{path:"/contacts/:id",children:Object(i.jsx)(o,{children:Object(i.jsx)(te,{})})}),Object(i.jsx)(a.a,{path:"/contacts",children:Object(i.jsx)(R,{children:Object(i.jsx)(te,{})})}),Object(i.jsx)(a.a,{path:"*"})]})})})}var ie=n(37),se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,88)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};n.n(ie).a.render(Object(i.jsx)(K.a.StrictMode,{children:Object(i.jsx)(ae,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/enigma-reloaded",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/enigma-reloaded","/service-worker.js");r?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):c(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):c(t,e)}))}}(),se()}},[[83,1,2]]]);
//# sourceMappingURL=main.52a46763.chunk.js.map