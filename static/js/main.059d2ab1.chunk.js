(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{146:function(e,t,n){},155:function(e,t){},157:function(e,t){},167:function(e,t){},169:function(e,t){},196:function(e,t){},197:function(e,t){},202:function(e,t){},204:function(e,t){},211:function(e,t){},230:function(e,t){},246:function(e,t){},275:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(136),i=n.n(a),o=(n(146),n(11)),s=n(34),u=n(141),l=n(0);function d(e){var t=e.isOpened,n=e.close,c=e.children;Object(r.useEffect)((function(){return t?document.body.classList.add("overflow-y-hidden"):document.body.classList.remove("overflow-y-hidden")}),[t]);var a=Object(r.useRef)(null);return Object(u.a)(a,n),t?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-70"}),Object(l.jsx)("div",{className:"absolute inset-0 items-center py-20 overflow-y-auto",children:Object(l.jsx)("div",{className:"mb-20 bg-white w-1/3 p-4 rounded shadow mx-auto",ref:a,children:c})})]}):null}var f=n(137),j=n(12),p=n(50),m=n(35);function b(e){var t=Object(r.useState)(),n=Object(o.a)(t,2),c=n[0],a=n[1];Object(r.useEffect)((function(){m.getItem(e).then((function(e){a(e)}))}),[a,e]);return[c,function(t){a(t),m.setItem(e,t)}]}var h,v=n(16),g=n.n(v),O=n(25),x=n(138),w=n(139),y=n(36),N=function(){function e(t,n){Object(x.a)(this,e),this.secret=t,this.storage=n}return Object(w.a)(e,[{key:"encrypt",value:function(e,t){if("object"===typeof t)t=JSON.stringify(t);else if("number"===typeof t)t=t.toString();else if("string"!==typeof t)throw new Error("invalid type");var n=y.AES.encrypt(t,this.secret);return this.storage.setItem(e,n.toString())}},{key:"decrypt",value:function(){var e=Object(O.a)(g.a.mark((function e(t){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getItem(t);case 2:if(n=e.sent,r=null,n){r=y.AES.decrypt(n,this.secret).toString(y.enc.Utf8);try{r=JSON.parse(r)}catch(c){}}return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(e){return this.storage.removeItem(e)}}]),e}();function k(e){return h?h.decrypt(e):null}function E(e,t){if(!h)throw"Pin not set";return h.encrypt(e,t)}function S(e){h=new N(e,m)}window.localforage=m;var P,V,C=p.utils.randomPrivateKey;function I(e){var t=e.children,n=b("pk-initialized"),r=Object(o.a)(n,2),c=r[0],a=r[1],i=Object(s.a)({setupPinModal:!1,nameValue:"",emailValue:"",pinValue:"",confirmPinValue:"",confirmMatch:!0,passwordStrength:"Too weak"});var u=Object(j.isEmpty)(i.pinValue.get())||"Too weak"===i.passwordStrength.get()||Object(j.isEmpty)(i.confirmPinValue.get())||!i.confirmMatch.get();return c?t:Object(l.jsxs)("div",{children:[Object(l.jsx)("button",{onClick:function(e){e.preventDefault(),i.merge({setupPinModal:!0})},children:"Get started"}),Object(l.jsx)(d,{isOpened:i.setupPinModal.get(),close:function(e){e.preventDefault(),i.merge({setupPinModal:!1})},children:Object(l.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault();var t=C();S(i.pinValue.get()),E("private-key",Array.from(t)),E("name",i.nameValue.get()),E("email",i.emailValue.get()),a(!0)},children:Object(l.jsxs)("fieldset",{children:[Object(l.jsx)("legend",{children:"PIN setup"}),Object(l.jsx)("div",{className:"pure-control-group",children:Object(l.jsx)("input",{name:"name",value:i.nameValue.get(),onChange:function(e){i.merge({nameValue:e.target.value})},placeholder:"Enter your name",className:"w-full"})}),Object(l.jsx)("div",{className:"pure-control-group",children:Object(l.jsx)("input",{type:"email",name:"email",value:i.emailValue.get(),onChange:function(e){i.merge({emailValue:e.target.value})},placeholder:"Enter email(to have a avatar)",className:"w-full"})}),Object(l.jsxs)("div",{className:"pure-control-group",children:[Object(l.jsx)("input",{name:"pin",value:i.pinValue.get(),onChange:function(e){var t=e.target.value,n=Object(f.passwordStrength)(t).value;i.merge({pinValue:e.target.value,passwordStrength:n})},placeholder:"Enter new PIN",className:"w-full",required:!0}),Object(l.jsx)("span",{className:"pure-form-message",children:i.passwordStrength.get()})]}),Object(l.jsxs)("div",{className:"pure-control-group",children:[Object(l.jsx)("input",{name:"pinConfirm",value:i.confirmPinValue.get(),onChange:function(e){var t=e.target.value;i.merge((function(e){return{confirmMatch:t===e.pinValue,confirmPinValue:t}}))},placeholder:"Confirm your pin",className:"w-full",required:!0}),!i.confirmMatch.get()&&Object(l.jsx)("span",{className:"pure-form-message",children:"Pins don't match"})]}),Object(l.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:u,children:"Submit"})]})})})]})}function T(){return M.apply(this,arguments)}function M(){return(M=Object(O.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(j.isEmpty)(P)){e.next=2;break}return e.abrupt("return",P);case 2:return e.next=4,k("private-key");case 4:return e.abrupt("return",P=e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(O.a)(g.a.mark((function e(){var t;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(j.isEmpty)(V)){e.next=2;break}return e.abrupt("return",V);case 2:return e.next=4,T();case 4:if(t=e.sent,!Object(j.isEmpty)(t)){e.next=7;break}return e.abrupt("return");case 7:return t=Uint8Array.from(t),e.next=10,p.getPublicKey(t);case 10:return e.abrupt("return",V=e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){var e=Object(r.useState)(),t=Object(o.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){(function(){return A.apply(this,arguments)})().then((function(e){c(e)}))})),n}var W=n(51);function F(e){var t=Object(r.useState)(),n=Object(o.a)(t,2),c=n[0],a=n[1];Object(r.useEffect)((function(){k(e).then((function(e){a(e)}))}),[a,e]);return[c,function(t){a(t),E(e,t)}]}function L(){var e,t=function(e){if(!Object(j.isEmpty)(e))return Object(W.a)(e)}(D()),n=F("name"),r=Object(o.a)(n,1)[0],c=F("email"),a=Object(o.a)(c,1)[0],i=r?Object(W.a)(r):"",s=a?(e=a,y.MD5(e).toString()):"",u="".concat(t,"\\").concat(i,"\\").concat(s);if(!t)return null;return Object(l.jsx)("div",{className:"p-3",children:Object(l.jsxs)("button",{className:"text-center bg-gray-300 hover:bg-gray-200 rounded p-2 border border-solid border-gray-300",onClick:function(e){e.preventDefault(),function(e){var t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select();var n=document.execCommand("copy");document.body.removeChild(t)}(u)},children:[Object(l.jsx)("div",{className:"font-bold",children:"My public key, name and email hashed"}),Object(l.jsx)("div",{children:u}),Object(l.jsx)("div",{className:"text-right text-sm",children:"Click to copy"})]})})}var U=n(6),B=n(277);function J(){var e=Object(U.f)(),t=Object(U.g)(),n=D(),c=b("pk-initialized"),a=Object(o.a)(c,1)[0],i=Object(r.useState)(!1),s=Object(o.a)(i,2),u=s[0],l=s[1],d=Object(B.a)(12e4);return Object(r.useEffect)((function(){if(void 0!==a)return null===a||n?l(!0):void setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50)}),[a,e,n,t,l,t.pathname]),Object(r.useEffect)((function(){n&&d&&(h=null,setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50))}),[d,n,e,t.pathname]),u}function R(e){var t=e.children,n=J();return Object(l.jsxs)(l.Fragment,{children:[t,n&&Object(l.jsx)(I,{children:Object(l.jsx)("div",{className:"w-full md:w-1/3 flex justify-center mx-auto",children:Object(l.jsx)(L,{})})})]})}function q(e){var t=e.children;return Object(l.jsx)("div",{className:"p-4",children:t})}var z=n.p+"static/media/enigma-logo.d8f45653.jpg";function K(){var e=Object(s.a)({pinValue:"",showError:!1}),t=Object(U.f)(),n=new URLSearchParams(Object(U.g)().search);function r(){return(r=Object(O.a)(g.a.mark((function r(c){var a,i;return g.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c.preventDefault(),a=n.get("redirectTo"),S(e.pinValue.get()),r.prev=3,r.next=6,k("private-key");case 6:if(i=r.sent,!Object(j.isEmpty)(i)){r.next=9;break}return r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 9:e.merge({pinValue:"",showError:!1}),setTimeout((function(){t.push(a)}),50),r.next=16;break;case 13:return r.prev=13,r.t0=r.catch(3),r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 16:case"end":return r.stop()}}),r,null,[[3,13]])})))).apply(this,arguments)}return Object(l.jsxs)("div",{className:"w-full md:w-1/3 mx-auto",children:[Object(l.jsx)("div",{className:"flex justify-center",children:Object(l.jsx)("img",{src:z,alt:"enigma"})}),Object(l.jsx)("form",{className:"pure-form",onSubmit:function(e){return r.apply(this,arguments)},children:Object(l.jsxs)("fieldset",{children:[Object(l.jsxs)("div",{className:"pure-control-group pb-4",children:[Object(l.jsx)("input",{type:"password",value:e.pinValue.get(),onChange:function(t){var n=t.target.value;e.merge({pinValue:n})},className:"w-full",placeholder:"Enter your PIN to continue"}),e.showError.get()&&Object(l.jsx)("span",{className:"pure-form-message text-red-500",children:"Invalid PIN"})]}),Object(l.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:Object(j.isEmpty)(e.pinValue.get()),children:"Unlock"})]})})]})}function G(){var e=Object(s.a)({modalOpened:!1,inputPkNameEmail:""});return Object(l.jsxs)("div",{children:[Object(l.jsx)("button",{className:"bg-black text-white p-3",onClick:function(t){t.preventDefault(),e.merge({modalOpened:!0})},children:"+ Add new contact"}),Object(l.jsx)(d,{isOpened:e.modalOpened.get(),close:function(){e.merge({modalOpened:!1})},children:Object(l.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault()},children:Object(l.jsxs)("fieldset",{children:[Object(l.jsx)("legend",{children:"Contact public key, name and email hashed"}),Object(l.jsx)("div",{className:"pure-control-group",children:Object(l.jsx)("input",{name:"inputPkNameEmail",value:e.inputPkNameEmail.get(),onChange:function(t){var n=t.target.value;e.merge({inputPkNameEmail:n})},placeholder:"Paste the contact code",className:"w-full"})}),Object(l.jsx)("button",{type:"submit",className:"pure-button pure-button-primary bg-black w-full",disabled:Object(j.isEmpty)(e.inputPkNameEmail.get()),children:"Add"})]})})})]})}function H(e){var t=e.children,n=J();return Object(l.jsxs)("div",{children:[Object(l.jsx)("div",{children:t}),n&&Object(l.jsxs)("div",{className:"w-full md:w-1/3 mx-auto pt-4",children:[Object(l.jsx)("h1",{className:"text-center text-2xl font-bold",children:"Contacts"}),Object(l.jsx)("div",{className:"flex justify-end",children:Object(l.jsx)(G,{})})]})]})}var $=n(20);function Q(){return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"flex justify-center",children:Object(l.jsx)("img",{src:z,alt:"enigma"})}),Object(l.jsxs)("div",{className:"flex flex-wrap justify-center",children:[Object(l.jsx)(X,{text:"Home",to:"/"}),Object(l.jsx)(X,{text:"Contacts",to:"/contacts"})]})]})}function X(e){var t=e.text,n=e.to;return Object(l.jsx)("div",{className:"mx-1 text-center bg-black p-2 rounded text-white",children:Object(l.jsx)($.b,{to:n,children:t})})}function Y(e){var t=e.children;return Object(l.jsx)($.a,{children:t})}function Z(){return Object(l.jsx)(Y,{children:Object(l.jsx)(q,{children:Object(l.jsxs)(U.c,{children:[Object(l.jsx)(U.a,{path:"/",exact:!0,children:Object(l.jsx)(R,{children:Object(l.jsx)(Q,{})})}),Object(l.jsx)(U.a,{path:"/unlock",children:Object(l.jsx)(K,{})}),Object(l.jsx)(U.a,{path:"/contacts",children:Object(l.jsx)(H,{children:Object(l.jsx)(Q,{})})}),Object(l.jsx)(U.a,{path:"*"})]})})})}var _=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,278)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))},ee=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function te(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)(Z,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/enigma-reloaded",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/enigma-reloaded","/service-worker.js");ee?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):te(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):te(t,e)}))}}(),_()},51:function(e,t,n){"use strict";(function(e){function r(t){return e.from(t).toString("base64")}n.d(t,"a",(function(){return r}))}).call(this,n(7).Buffer)}},[[275,1,2]]]);
//# sourceMappingURL=main.059d2ab1.chunk.js.map