(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{146:function(e,t,n){},155:function(e,t){},157:function(e,t){},167:function(e,t){},169:function(e,t){},196:function(e,t){},197:function(e,t){},202:function(e,t){},204:function(e,t){},211:function(e,t){},230:function(e,t){},246:function(e,t){},275:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(136),i=n.n(a),s=(n(146),n(11)),u=n(34),o=n(141),l=n(0);function d(e){var t=e.isOpened,n=e.close,c=e.children;Object(r.useEffect)((function(){return t?document.body.classList.add("overflow-y-hidden"):document.body.classList.remove("overflow-y-hidden")}),[t]);var a=Object(r.useRef)(null);return Object(o.a)(a,n),t?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-70"}),Object(l.jsx)("div",{className:"absolute inset-0 items-center py-20 overflow-y-auto",children:Object(l.jsx)("div",{className:"mb-20 bg-white w-1/3 p-4 rounded shadow mx-auto",ref:a,children:c})})]}):null}var j=n(137),p=n(12),m=n(50),b=n(35);function f(e){var t=Object(r.useState)(),n=Object(s.a)(t,2),c=n[0],a=n[1];Object(r.useEffect)((function(){b.getItem(e).then((function(e){a(e)}))}),[a,e]);return[c,function(t){a(t),b.setItem(e,t)}]}var h,O=n(16),x=n.n(O),v=n(25),g=n(138),y=n(139),w=n(36),N=function(){function e(t,n){Object(g.a)(this,e),this.secret=t,this.storage=n}return Object(y.a)(e,[{key:"encrypt",value:function(e,t){if("object"===typeof t)t=JSON.stringify(t);else if("number"===typeof t)t=t.toString();else if("string"!==typeof t)throw new Error("invalid type");var n=w.AES.encrypt(t,this.secret);return this.storage.setItem(e,n.toString())}},{key:"decrypt",value:function(){var e=Object(v.a)(x.a.mark((function e(t){var n,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getItem(t);case 2:if(n=e.sent,r=null,n){r=w.AES.decrypt(n,this.secret).toString(w.enc.Utf8);try{r=JSON.parse(r)}catch(c){}}return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(e){return this.storage.removeItem(e)}}]),e}();function k(e){return h?h.decrypt(e):null}function E(e,t){if(!h)throw"Pin not set";return h.encrypt(e,t)}function V(e){h=new N(e,b)}window.localforage=b;var P,S,C=m.utils.randomPrivateKey;function I(e){var t=e.children,n=f("pk-initialized"),r=Object(s.a)(n,2),c=r[0],a=r[1],i=Object(u.a)({setupPinModal:!1,nameValue:"",emailValue:"",pinValue:"",confirmPinValue:"",confirmMatch:!0,passwordStrength:"Too weak"});var o=Object(p.isEmpty)(i.pinValue.get())||"Too weak"===i.passwordStrength.get()||Object(p.isEmpty)(i.confirmPinValue.get())||!i.confirmMatch.get();return c?t:Object(l.jsxs)("div",{children:[Object(l.jsx)("button",{onClick:function(e){e.preventDefault(),i.merge({setupPinModal:!0})},children:"Get started"}),Object(l.jsx)(d,{isOpened:i.setupPinModal.get(),close:function(e){e.preventDefault(),i.merge({setupPinModal:!1})},children:Object(l.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault();var t=C();V(i.pinValue.get()),E("private-key",Array.from(t)),E("name",i.nameValue.get()),E("email",i.emailValue.get()),a(!0)},children:Object(l.jsxs)("fieldset",{children:[Object(l.jsx)("legend",{children:"PIN setup"}),Object(l.jsx)("div",{className:"pure-control-group",children:Object(l.jsx)("input",{name:"name",value:i.nameValue.get(),onChange:function(e){i.merge({nameValue:e.target.value})},placeholder:"Enter your name",className:"w-full"})}),Object(l.jsx)("div",{className:"pure-control-group",children:Object(l.jsx)("input",{type:"email",name:"email",value:i.emailValue.get(),onChange:function(e){i.merge({emailValue:e.target.value})},placeholder:"Enter email(to have a avatar)",className:"w-full"})}),Object(l.jsxs)("div",{className:"pure-control-group",children:[Object(l.jsx)("input",{name:"pin",value:i.pinValue.get(),onChange:function(e){var t=e.target.value,n=Object(j.passwordStrength)(t).value;i.merge({pinValue:e.target.value,passwordStrength:n})},placeholder:"Enter new PIN",className:"w-full",required:!0}),Object(l.jsx)("span",{className:"pure-form-message",children:i.passwordStrength.get()})]}),Object(l.jsxs)("div",{className:"pure-control-group",children:[Object(l.jsx)("input",{name:"pinConfirm",value:i.confirmPinValue.get(),onChange:function(e){var t=e.target.value;i.merge((function(e){return{confirmMatch:t===e.pinValue,confirmPinValue:t}}))},placeholder:"Confirm your pin",className:"w-full",required:!0}),!i.confirmMatch.get()&&Object(l.jsx)("span",{className:"pure-form-message",children:"Pins don't match"})]}),Object(l.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:o,children:"Submit"})]})})})]})}function M(){return T.apply(this,arguments)}function T(){return(T=Object(v.a)(x.a.mark((function e(){return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.isEmpty)(P)){e.next=2;break}return e.abrupt("return",P);case 2:return e.next=4,k("private-key");case 4:return e.abrupt("return",P=e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=Object(v.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.isEmpty)(S)){e.next=2;break}return e.abrupt("return",S);case 2:return e.next=4,M();case 4:if(t=e.sent,!Object(p.isEmpty)(t)){e.next=7;break}return e.abrupt("return");case 7:return t=Uint8Array.from(t),e.next=10,m.getPublicKey(t);case 10:return e.abrupt("return",S=e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){var e=Object(r.useState)(),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(r.useEffect)((function(){(function(){return D.apply(this,arguments)})().then((function(e){c(e)}))})),n}var F=n(51);function L(e){var t=Object(r.useState)(),n=Object(s.a)(t,2),c=n[0],a=n[1];Object(r.useEffect)((function(){k(e).then((function(e){a(e)}))}),[a,e]);return[c,function(t){a(t),E(e,t)}]}function J(){var e,t=function(e){if(!Object(p.isEmpty)(e))return Object(F.a)(e)}(A()),n=L("name"),r=Object(s.a)(n,1)[0],c=L("email"),a=Object(s.a)(c,1)[0],i=r?Object(F.a)(r):"",u=a?(e=a,w.MD5(e).toString()):"",o="".concat(t,"\\").concat(i,"\\").concat(u);if(!t)return null;return Object(l.jsx)("div",{className:"p-3",children:Object(l.jsxs)("button",{className:"text-center bg-gray-300 hover:bg-gray-200 rounded p-2 border border-solid border-gray-300",onClick:function(e){e.preventDefault(),function(e){var t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select();var n=document.execCommand("copy");document.body.removeChild(t)}(o)},children:[Object(l.jsx)("div",{className:"font-bold",children:"My public key, name and email hashed"}),Object(l.jsx)("div",{children:o}),Object(l.jsx)("div",{className:"text-right text-sm",children:"Click to copy"})]})})}var U=n(6),B=n(277);function q(){var e=Object(U.f)(),t=Object(U.g)(),n=A(),c=f("pk-initialized"),a=Object(s.a)(c,1)[0],i=Object(r.useState)(!1),u=Object(s.a)(i,2),o=u[0],l=u[1],d=Object(B.a)(12e4);return Object(r.useEffect)((function(){if(void 0!==a)return null===a||n?l(!0):void setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50)}),[a,e,n,t,l,t.pathname]),Object(r.useEffect)((function(){n&&d&&(h=null,setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50))}),[d,n,e,t.pathname]),o}function z(e){var t=e.children,n=q();return Object(l.jsxs)(l.Fragment,{children:[t,n&&Object(l.jsx)(I,{children:Object(l.jsx)("div",{className:"w-full md:w-1/3 flex justify-center mx-auto",children:Object(l.jsx)(J,{})})})]})}function K(e){var t=e.children;return Object(l.jsx)("div",{className:"p-4",children:t})}var R=n.p+"static/media/enigma-logo.d8f45653.jpg";function G(){var e=Object(u.a)({pinValue:"",showError:!1}),t=Object(U.f)(),n=new URLSearchParams(Object(U.g)().search);function r(){return(r=Object(v.a)(x.a.mark((function r(c){var a,i;return x.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c.preventDefault(),a=n.get("redirectTo"),V(e.pinValue.get()),r.prev=3,r.next=6,k("private-key");case 6:if(i=r.sent,!Object(p.isEmpty)(i)){r.next=9;break}return r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 9:e.merge({pinValue:"",showError:!1}),setTimeout((function(){t.push(a)}),50),r.next=16;break;case 13:return r.prev=13,r.t0=r.catch(3),r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 16:case"end":return r.stop()}}),r,null,[[3,13]])})))).apply(this,arguments)}return Object(l.jsxs)("div",{className:"w-full md:w-1/3 mx-auto",children:[Object(l.jsx)("div",{className:"flex justify-center",children:Object(l.jsx)("img",{src:R,alt:"enigma"})}),Object(l.jsx)("form",{className:"pure-form",onSubmit:function(e){return r.apply(this,arguments)},children:Object(l.jsxs)("fieldset",{children:[Object(l.jsxs)("div",{className:"pure-control-group pb-4",children:[Object(l.jsx)("input",{type:"password",value:e.pinValue.get(),onChange:function(t){var n=t.target.value;e.merge({pinValue:n})},className:"w-full",placeholder:"Enter your PIN to continue"}),e.showError.get()&&Object(l.jsx)("span",{className:"pure-form-message text-red-500",children:"Invalid PIN"})]}),Object(l.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:Object(p.isEmpty)(e.pinValue.get()),children:"Unlock"})]})})]})}function H(){var e=Object(u.a)({modalOpened:!1,inputPkNameEmail:""});return Object(l.jsxs)("div",{children:[Object(l.jsx)("button",{className:"bg-black text-white p-3",onClick:function(t){t.preventDefault(),e.merge({modalOpened:!0})},children:"+ Add new contact"}),Object(l.jsx)(d,{isOpened:e.modalOpened.get(),close:function(){e.merge({modalOpened:!1})},children:Object(l.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault()},children:Object(l.jsxs)("fieldset",{children:[Object(l.jsx)("legend",{children:"Contact public key, name and email hashed"}),Object(l.jsx)("div",{className:"pure-control-group",children:Object(l.jsx)("input",{name:"inputPkNameEmail",value:e.inputPkNameEmail.get(),onChange:function(t){var n=t.target.value;e.merge({inputPkNameEmail:n})},placeholder:"Paste the contact code",className:"w-full"})}),Object(l.jsx)("button",{type:"submit",className:"pure-button pure-button-primary bg-black w-full",disabled:Object(p.isEmpty)(e.inputPkNameEmail.get()),children:"Add"})]})})})]})}function Q(e){var t=e.children,n=q();return Object(l.jsxs)("div",{children:[Object(l.jsx)("div",{children:t}),n&&Object(l.jsxs)("div",{className:"w-full md:w-1/3 mx-auto pt-4",children:[Object(l.jsx)("h1",{className:"text-center text-2xl font-bold",children:"Contacts"}),Object(l.jsx)("div",{className:"flex justify-end",children:Object(l.jsx)(H,{})})]})]})}var W=n(20);function X(){return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"flex justify-center",children:Object(l.jsx)("img",{src:R,alt:"enigma"})}),Object(l.jsxs)("div",{className:"flex flex-wrap justify-center",children:[Object(l.jsx)(Y,{text:"Home",to:"/"}),Object(l.jsx)(Y,{text:"Contacts",to:"/contacts"})]})]})}function Y(e){var t=e.text,n=e.to;return Object(l.jsx)("div",{className:"mx-1 text-center bg-black p-2 rounded text-white",children:Object(l.jsx)(W.b,{to:n,children:t})})}function Z(e){var t=e.children;return Object(l.jsx)(W.a,{children:t})}function $(){return Object(l.jsx)(Z,{children:Object(l.jsx)(K,{children:Object(l.jsxs)(U.c,{children:[Object(l.jsx)(U.a,{path:"/",exact:!0,children:Object(l.jsx)(z,{children:Object(l.jsx)(X,{})})}),Object(l.jsx)(U.a,{path:"/unlock",children:Object(l.jsx)(G,{})}),Object(l.jsx)(U.a,{path:"/contacts",children:Object(l.jsx)(Q,{children:Object(l.jsx)(X,{})})}),Object(l.jsx)(U.a,{path:"*"})]})})})}var _=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,278)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};i.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)($,{})}),document.getElementById("root")),_()},51:function(e,t,n){"use strict";(function(e){function r(t){return e.from(t).toString("base64")}n.d(t,"a",(function(){return r}))}).call(this,n(7).Buffer)}},[[275,1,2]]]);
//# sourceMappingURL=main.cf574c29.chunk.js.map