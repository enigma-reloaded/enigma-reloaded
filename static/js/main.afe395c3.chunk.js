(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{39:function(e,t,n){},40:function(e,t,n){},46:function(e,t){},75:function(e,t){},83:function(e,t,n){"use strict";n.r(t);n(39),n(40);var r=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function c(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var a=n(3),i=n(0);function o(e){var t=e.children;return Object(i.jsx)("div",{className:"p-4",children:t})}var s=n(5),u=n(11),l=n(1),d=n.n(l),j=n(38);function p(e){var t=e.isOpened,n=e.close,r=e.children;Object(l.useEffect)((function(){return t?document.body.classList.add("overflow-y-hidden"):document.body.classList.remove("overflow-y-hidden")}),[t]);var c=Object(l.useRef)(null);return Object(j.a)(c,n),t?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-70"}),Object(i.jsx)("div",{className:"absolute inset-0 items-center py-20 overflow-y-auto",children:Object(i.jsx)("div",{className:"mb-20 bg-white w-1/3 p-4 rounded shadow mx-auto",ref:c,children:r})})]}):null}function m(){var e=Object(u.a)({inputPkNameEmail:"",modalOpened:!1});return Object(i.jsxs)("div",{children:[Object(i.jsx)("button",{className:"bg-black text-white p-3",onClick:function(t){t.preventDefault(),e.merge({modalOpened:!0})},children:"+ Add new contact"}),Object(i.jsx)(p,{isOpened:e.modalOpened.get(),close:function(){e.merge({modalOpened:!1})},children:Object(i.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault()},children:Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("legend",{children:"Contact public key, name and email hashed"}),Object(i.jsx)("div",{className:"pure-control-group",children:Object(i.jsx)("input",{name:"inputPkNameEmail",value:e.inputPkNameEmail.get(),onChange:function(t){var n=t.target.value;e.merge({inputPkNameEmail:n})},placeholder:"Paste the contact code",className:"w-full"})}),Object(i.jsx)("button",{type:"submit",className:"pure-button pure-button-primary bg-black w-full",disabled:Object(s.isEmpty)(e.inputPkNameEmail.get()),children:"Add"})]})})})]})}var f,b=n(6),h=n(16),g=n(9),O=n.n(g),v=n(13),x=n(32),w=n(33),y=n(17),N=function(){function e(t,n){Object(x.a)(this,e),this.secret=t,this.storage=n}return Object(w.a)(e,[{key:"encrypt",value:function(e,t){if("object"===typeof t)t=JSON.stringify(t);else if("number"===typeof t)t=t.toString();else if("string"!==typeof t)throw new Error("invalid type");var n=y.AES.encrypt(t,this.secret);return this.storage.setItem(e,n.toString())}},{key:"decrypt",value:function(){var e=Object(v.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getItem(t);case 2:if(n=e.sent,r=null,n){r=y.AES.decrypt(n,this.secret).toString(y.enc.Utf8);try{r=JSON.parse(r)}catch(c){}}return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(e){return this.storage.removeItem(e)}}]),e}();function k(e){return f?f.decrypt(e):null}function E(e,t){if(!f)throw"Pin not set";return f.encrypt(e,t)}function S(e){f=new N(e,h)}window.localforage=h;var P,V=n(85);function C(e){var t=Object(l.useState)(),n=Object(b.a)(t,2),r=n[0],c=n[1];Object(l.useEffect)((function(){h.getItem(e).then((function(e){c(e)}))}),[c,e]);return[r,function(t){c(t),h.setItem(e,t)}]}function T(){return(T=Object(v.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(s.isEmpty)(P)){e.next=2;break}return e.abrupt("return",P);case 2:return e.next=4,k("key-pair");case 4:if(t=e.sent,!Object(s.isEmpty)(t)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",P=Uint8Array.from(t.publicKey));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){var e=Object(l.useState)(),t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(l.useEffect)((function(){(function(){return T.apply(this,arguments)})().then((function(e){r(e)}))})),n}function A(){var e=Object(a.f)(),t=Object(a.g)(),n=I(),r=C("pk-initialized"),c=Object(b.a)(r,1)[0],i=Object(l.useState)(!1),o=Object(b.a)(i,2),s=o[0],u=o[1],d=Object(V.a)(12e4);return Object(l.useEffect)((function(){if(void 0!==c)return null===c||n?u(!0):void setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50)}),[c,e,n,t,u,t.pathname]),Object(l.useEffect)((function(){n&&d&&(f=null,setTimeout((function(){e.push("/unlock?redirectTo=".concat(t.pathname))}),50))}),[d,n,e,t.pathname]),s}function M(e){var t=e.children,n=A();return Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{children:t}),n&&Object(i.jsxs)("div",{className:"w-full md:w-1/3 mx-auto pt-4",children:[Object(i.jsx)("h1",{className:"text-center text-2xl font-bold",children:"Contacts"}),Object(i.jsx)("div",{className:"flex justify-end",children:Object(i.jsx)(m,{})})]})]})}var D=n(35);var W=n(36);function F(e){var t=e.children,n=C("pk-initialized"),r=Object(b.a)(n,2),c=r[0],a=r[1],o=Object(u.a)({confirmMatch:!0,confirmPinValue:"",emailValue:"",nameValue:"",passwordStrength:"Too weak",pinValue:"",setupPinModal:!1});var l=Object(s.isEmpty)(o.pinValue.get())||"Too weak"===o.passwordStrength.get()||Object(s.isEmpty)(o.confirmPinValue.get())||!o.confirmMatch.get();return c?t:Object(i.jsxs)("div",{children:[Object(i.jsx)("button",{onClick:function(e){e.preventDefault(),o.merge({setupPinModal:!0})},children:"Get started"}),Object(i.jsx)(p,{isOpened:o.setupPinModal.get(),close:function(e){e.preventDefault(),o.merge({setupPinModal:!1})},children:Object(i.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault();var t=D.box.keyPair();S(o.pinValue.get()),E("key-pair",{publicKey:Array.from(t.publicKey),secretKey:Array.from(t.secretKey)}),E("name",o.nameValue.get()),E("email",o.emailValue.get()),a(!0)},children:Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("legend",{children:"PIN setup"}),Object(i.jsx)("div",{className:"pure-control-group",children:Object(i.jsx)("input",{name:"name",value:o.nameValue.get(),onChange:function(e){o.merge({nameValue:e.target.value})},placeholder:"Enter your name",className:"w-full"})}),Object(i.jsx)("div",{className:"pure-control-group",children:Object(i.jsx)("input",{type:"email",name:"email",value:o.emailValue.get(),onChange:function(e){o.merge({emailValue:e.target.value})},placeholder:"Enter email(to have a avatar)",className:"w-full"})}),Object(i.jsxs)("div",{className:"pure-control-group",children:[Object(i.jsx)("input",{name:"pin",value:o.pinValue.get(),onChange:function(e){var t=e.target.value,n=Object(W.passwordStrength)(t).value;o.merge({passwordStrength:n,pinValue:e.target.value})},placeholder:"Enter new PIN",className:"w-full",required:!0}),Object(i.jsx)("span",{className:"pure-form-message",children:o.passwordStrength.get()})]}),Object(i.jsxs)("div",{className:"pure-control-group",children:[Object(i.jsx)("input",{name:"pinConfirm",value:o.confirmPinValue.get(),onChange:function(e){var t=e.target.value;o.merge((function(e){return{confirmMatch:t===e.pinValue,confirmPinValue:t}}))},placeholder:"Confirm your pin",className:"w-full",required:!0}),!o.confirmMatch.get()&&Object(i.jsx)("span",{className:"pure-form-message",children:"Pins don't match"})]}),Object(i.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:l,children:"Submit"})]})})})]})}var L=n(21);function U(e){var t=Object(l.useState)(),n=Object(b.a)(t,2),r=n[0],c=n[1];Object(l.useEffect)((function(){k(e).then((function(e){c(e)}))}),[c,e]);return[r,function(t){c(t),E(e,t)}]}function B(){var e,t=function(e){if(!Object(s.isEmpty)(e))return Object(L.encodeBase64)(e)}(I()),n=U("name"),r=Object(b.a)(n,1)[0],c=U("email"),a=Object(b.a)(c,1)[0],o=r?Object(L.encodeBase64)(r):"",l=a?(e=a,Object(y.MD5)(e).toString()):"",d="".concat(t,"\\").concat(o,"\\").concat(l),j=Object(u.a)({showCopied:!1});if(!t)return null;return Object(i.jsx)("div",{className:"p-3",children:Object(i.jsxs)("button",{className:"text-center bg-gray-300 hover:bg-gray-200 rounded p-2 border border-solid border-gray-300",onClick:function(e){e.preventDefault(),function(e){var t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select();var n=document.execCommand("copy");document.body.removeChild(t)}(d),j.merge({showCopied:!0}),setTimeout((function(){j.merge({showCopied:!1})}),1500)},children:[Object(i.jsx)("div",{className:"font-bold",children:"My public key, name and email hashed"}),Object(i.jsx)("div",{children:d}),Object(i.jsx)("div",{className:"text-right text-sm",children:"Click to copy"})]})})}function K(e){var t=e.children,n=A();return Object(i.jsxs)(i.Fragment,{children:[t,n&&Object(i.jsx)(F,{children:Object(i.jsx)("div",{className:"w-full md:w-1/3 flex justify-center mx-auto",children:Object(i.jsx)(B,{})})})]})}var J=n(10),R=n.p+"static/media/enigma-logo.d8f45653.jpg";function q(){return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"flex justify-center",children:Object(i.jsx)("img",{src:R,alt:"enigma"})}),Object(i.jsxs)("div",{className:"flex flex-wrap justify-center",children:[Object(i.jsx)(z,{text:"Home",to:"/"}),Object(i.jsx)(z,{text:"Contacts",to:"/contacts"})]})]})}function z(e){var t=e.text,n=e.to;return Object(i.jsx)("div",{className:"mx-1 text-center bg-black p-2 rounded text-white",children:Object(i.jsx)(J.b,{to:n,children:t})})}function G(e){var t=e.children;return Object(i.jsx)(J.a,{children:t})}function H(){var e=Object(u.a)({pinValue:"",showError:!1}),t=Object(a.f)(),n=new URLSearchParams(Object(a.g)().search);function r(){return(r=Object(v.a)(O.a.mark((function r(c){var a,i;return O.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c.preventDefault(),a=n.get("redirectTo"),S(e.pinValue.get()),r.prev=3,r.next=6,k("key-pair");case 6:if(i=r.sent,!Object(s.isEmpty)(i)){r.next=9;break}return r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 9:e.merge({pinValue:"",showError:!1}),setTimeout((function(){t.push(a)}),50),r.next=16;break;case 13:return r.prev=13,r.t0=r.catch(3),r.abrupt("return",e.merge({pinValue:"",showError:!0}));case 16:case"end":return r.stop()}}),r,null,[[3,13]])})))).apply(this,arguments)}return Object(i.jsxs)("div",{className:"w-full md:w-1/3 mx-auto",children:[Object(i.jsx)("div",{className:"flex justify-center",children:Object(i.jsx)("img",{src:R,alt:"enigma"})}),Object(i.jsx)("form",{className:"pure-form",onSubmit:function(e){return r.apply(this,arguments)},children:Object(i.jsxs)("fieldset",{children:[Object(i.jsxs)("div",{className:"pure-control-group pb-4",children:[Object(i.jsx)("input",{type:"password",value:e.pinValue.get(),onChange:function(t){var n=t.target.value;e.merge({pinValue:n})},className:"w-full",placeholder:"Enter your PIN to continue"}),e.showError.get()&&Object(i.jsx)("span",{className:"pure-form-message text-red-500",children:"Invalid PIN"})]}),Object(i.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:Object(s.isEmpty)(e.pinValue.get()),children:"Unlock"})]})})]})}function $(){return Object(i.jsx)(G,{children:Object(i.jsx)(o,{children:Object(i.jsxs)(a.c,{children:[Object(i.jsx)(a.a,{path:"/",exact:!0,children:Object(i.jsx)(K,{children:Object(i.jsx)(q,{})})}),Object(i.jsx)(a.a,{path:"/unlock",children:Object(i.jsx)(H,{})}),Object(i.jsx)(a.a,{path:"/contacts",children:Object(i.jsx)(M,{children:Object(i.jsx)(q,{})})}),Object(i.jsx)(a.a,{path:"*"})]})})})}var Q=n(37),X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,86)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),c(e),a(e),i(e)}))};n.n(Q).a.render(Object(i.jsx)(d.a.StrictMode,{children:Object(i.jsx)($,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/enigma-reloaded",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/enigma-reloaded","/service-worker.js");r?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):c(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):c(t,e)}))}}(),X()}},[[83,1,2]]]);
//# sourceMappingURL=main.afe395c3.chunk.js.map