(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{128:function(e,t,n){},129:function(e,t,n){},133:function(e,t){},136:function(e,t){},267:function(e,t,n){"use strict";n.r(t);n(128),n(129);var c=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function r(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(130),n(131);var a=n(9),s=n(1),i=n.n(s),l=n(12),o=n(37),u=n(30),d=n(4),j=Object(d.a)({});function b(e){var t=Object(d.c)(j);Object(s.useEffect)((function(){void 0===t[e].get()&&u.getItem(e).then((function(n){t.merge(Object(o.a)({},e,n))}))}),[e,t]);var n=t[e].get();return void 0===n&&(n="NOT_READY"),[n,function(n){t.merge(Object(o.a)({},e,n)),u.setItem(e,n)}]}var p=n(20);var m=n(6),h=n(121),f=n(2),O=n.n(f),x=n(3),g=n(40),v=n(41),y=n(43),w=n(42);function N(e){w.b.error(e)}var k,E=function(){function e(t,n){Object(g.a)(this,e),this.secret=t,this.storage=n}return Object(v.a)(e,[{key:"encrypt",value:function(e,t){if("object"===typeof t)t=JSON.stringify(t);else if("number"===typeof t)t=t.toString();else if("string"!==typeof t)throw new Error("invalid type");var n,c=y.AES.encrypt(t,this.secret);try{n=this.storage.setItem(e,c.toString())}catch(r){throw N("Unable to save more data"),r}return n}},{key:"decrypt",value:function(){var e=Object(x.a)(O.a.mark((function e(t){var n,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storage.getItem(t);case 2:if(n=e.sent,c=null,n){c=y.AES.decrypt(n,this.secret).toString(y.enc.Utf8);try{c=JSON.parse(c)}catch(r){}}return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(e){return this.storage.removeItem(e)}}]),e}(),I=Object(d.a)({privateKey:null,publicKey:null});function C(){var e=Object(d.c)(I);return{privateKey:e.privateKey.get(),publicKey:e.publicKey.get(),setKeyPair:function(e){var t=e.publicKey,n=e.privateKey;I.merge({privateKey:n,publicKey:t})}}}function S(e){return k?k.decrypt(e):null}function P(e,t){if(!k)throw new Error("Pin not set");return k.encrypt(e,t)}function D(e){k=new E(e,u)}function K(){return A.apply(this,arguments)}function A(){return(A=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.next=3,k.storage.iterate((function(e,n){t[n]=e}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){k=null,I.merge({privateKey:null,publicKey:null})}window.localforage=u;var R=n(0);function V(e){var t=e.title,n=e.children;return Object(R.jsxs)("div",{className:"p-2 bg-gray-300 rounded my-2",children:[Object(R.jsx)("div",{className:"italic font-bold",children:t}),Object(R.jsx)("div",{className:"pt-2",children:n})]})}function F(){return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)("div",{className:"w-full md:w-1/2",children:[Object(R.jsx)("div",{className:"font-bold text-3xl",children:"Engima Reloaded"}),Object(R.jsxs)("div",{className:"mt-12",children:[Object(R.jsx)("div",{className:"font-bold mb-2",children:"Features"}),Object(R.jsx)("div",{className:"pl-4",children:Object(R.jsxs)("ul",{className:"list-disc",children:[Object(R.jsx)("li",{children:"DIY Encrypt and decrypt messages and files"}),Object(R.jsxs)("li",{children:[Object(R.jsx)("a",{href:"https://github.com/enigma-reloaded/enigma-reloaded/blob/master/LICENSE",target:"_blank",className:"underline",children:"Open source license(GPL V3)"})," and ",Object(R.jsx)("a",{href:"https://github.com/enigma-reloaded/enigma-reloaded",target:"_blank",className:"underline",children:"open source code"})]}),Object(R.jsxs)("li",{className:"mt-2",children:["Local data such as contacts and messages are encrypted using ",Object(R.jsx)("b",{children:"AES-256"}),", and your PIN is used as the passphrase"]}),Object(R.jsxs)("li",{className:"my-2",children:["Messages and files are encrypted using ",Object(R.jsx)("b",{children:"Public-key authenticated encryption (box)"})," from ",Object(R.jsx)("a",{className:"underline",href:"https://github.com/dchest/tweetnacl-js",target:"_blank",children:"https://github.com/dchest/tweetnacl-js"}),". Which is implements ",Object(R.jsx)("b",{children:"x25519-xsalsa20-poly1305"})]}),Object(R.jsx)("li",{children:"No ads, tracking, remote server"}),Object(R.jsx)("li",{children:"Offline support"}),Object(R.jsxs)("li",{children:["Compatible with services such as: ",Object(R.jsx)("b",{children:"Messenger, Signal, Slack, Whatsapp, Twitter, Instagram DM, SMS etc"}),". You can even print the cypher on a paper"]}),Object(R.jsxs)("li",{children:["Import export ",Object(R.jsx)("b",{children:"encrypted backups"})]})]})})]})]}),Object(R.jsxs)("div",{className:"mt-12",children:[Object(R.jsx)("div",{className:"font-bold mb-2",children:"FAQ"}),Object(R.jsxs)(V,{title:"What is enigma?",children:["Enigma is a simple DIY(Do it yourself) program that runs inside your browser that helps you:",Object(R.jsx)("div",{className:"pl-4",children:Object(R.jsxs)("ul",{className:"list-disc",children:[Object(R.jsx)("li",{children:"Encrypt and decrypt messages"}),Object(R.jsx)("li",{children:"Encrypt and decrypt files"}),Object(R.jsx)("li",{children:"Store contacts and conversations"})]})})]}),Object(R.jsx)(V,{title:"Why is called enigma?",children:Object(R.jsxs)("div",{children:["It's a common name, that is already associated with secrecy, and your life should be private. Enigma reloaded single purpose is to help people ",Object(R.jsx)("a",{className:"underline",href:"https://www.youtube.com/watch?v=0hLjuVyIIrs",target:"_blank",children:"against the current Big Tech Surveillance"})]})}),Object(R.jsx)(V,{title:"Does it have anything to do with the nazi?",children:"No"}),Object(R.jsx)(V,{title:"Can big tech claims about end to end encryption be trusted?",children:"No"}),Object(R.jsx)(V,{title:"Is it military grade secure?",children:Object(R.jsx)("div",{className:"pl-4",children:Object(R.jsxs)("ul",{className:"list-disc",children:[Object(R.jsx)("li",{children:"\u2713 Strong encryption"}),Object(R.jsx)("li",{children:"\u2713 Access control"}),Object(R.jsx)("li",{children:"\u2713 Encrypted backups"}),Object(R.jsx)("li",{children:"\u2713 No external services(except the optional gravatar for user avatars)"})]})})}),Object(R.jsx)(V,{title:"Why did you build this?",children:"As a person who knows the truth and has the skills, I felt morally obligated."}),Object(R.jsx)(V,{title:"Is it 'really' for free?",children:Object(R.jsxs)("div",{children:[Object(R.jsx)("div",{children:"100% free, no ads, no tracking. If Enigma Reloaded helped you, that's enough for me. But if you want, you can donate me some Monero"}),Object(R.jsx)("div",{children:Object(R.jsx)("b",{children:"1234"})})]})})]})]})}var T=n.p+"static/media/enigma-logo.d8f45653.jpg";function B(e){var t=e.children;return Object(R.jsxs)("div",{children:[Object(R.jsx)("div",{className:"flex justify-center",children:Object(R.jsx)("img",{src:T,alt:"enigma"})}),Object(R.jsx)("div",{className:"py-2",children:t}),Object(R.jsx)(F,{})]})}var L=n(126);function U(e){var t=e.isOpened,n=e.close,c=e.children;Object(s.useEffect)((function(){return t?document.body.classList.add("overflow-y-hidden"):document.body.classList.remove("overflow-y-hidden")}),[t]);var r=Object(s.useRef)(null);return Object(L.a)(r,n),t?Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-70"}),Object(R.jsx)("div",{className:"absolute inset-0 items-center py-20 overflow-y-auto px-2 md:px-0",children:Object(R.jsx)("div",{className:"mb-20 bg-white md:w-1/3 w-full p-4 rounded shadow mx-auto",ref:r,children:c})})]}):null}function W(){var e=b("pk-initialized"),t=Object(a.a)(e,2),n=(t[0],t[1]),c=Object(d.c)({confirmMatch:!0,confirmPinValue:"",emailValue:"",nameValue:"",passwordStrength:"Too weak",pinValue:"",setupPinModal:!1});var r=Object(m.isEmpty)(c.pinValue.get())||"Too weak"===c.passwordStrength.get()||Object(m.isEmpty)(c.confirmPinValue.get())||!c.confirmMatch.get();return Object(R.jsxs)("div",{children:[Object(R.jsx)(B,{children:Object(R.jsx)("div",{className:"flex justify-center",children:Object(R.jsx)("button",{onClick:function(e){e.preventDefault(),c.merge({setupPinModal:!0})},className:"bg-black text-white text-4xl rounded p-2",children:"Get started"})})}),Object(R.jsx)(U,{isOpened:c.setupPinModal.get(),close:function(e){e.preventDefault(),c.merge({setupPinModal:!1})},children:Object(R.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault();var t=p.box.keyPair();D(c.pinValue.get()),P("key-pair",{publicKey:Array.from(t.publicKey),secretKey:Array.from(t.secretKey)}),P("name",c.nameValue.get()),P("email",c.emailValue.get().toLowerCase().replace(/\s/g,"")),n(!0)},children:Object(R.jsxs)("fieldset",{children:[Object(R.jsx)("legend",{children:"PIN setup"}),Object(R.jsxs)("div",{className:"pure-control-group",children:[Object(R.jsx)("input",{name:"name",value:c.nameValue.get(),onChange:function(e){c.merge({nameValue:e.target.value})},placeholder:"Enter your name",className:"w-full"}),Object(R.jsx)("span",{className:"pure-form-message",children:"Optional"})]}),Object(R.jsxs)("div",{className:"pure-control-group",children:[Object(R.jsx)("input",{type:"email",name:"email",value:c.emailValue.get(),onChange:function(e){c.merge({emailValue:e.target.value})},placeholder:"Your email to have a avatar from gravatar.com",className:"w-full"}),Object(R.jsx)("span",{className:"pure-form-message",children:"Optional"})]}),Object(R.jsxs)("div",{className:"pure-control-group",children:[Object(R.jsx)("input",{name:"pin",value:c.pinValue.get(),onChange:function(e){var t=e.target.value,n=Object(h.passwordStrength)(t).value;c.merge({passwordStrength:n,pinValue:e.target.value})},placeholder:"Enter new PIN",className:"w-full",required:!0}),c.pinValue.get().length>0&&Object(R.jsx)("span",{className:"pure-form-message",children:c.passwordStrength.get()}),Object(R.jsxs)("span",{className:"pure-form-message",children:["You can't recover or change the PIN later. ",Object(R.jsx)("span",{className:"underline",children:"Make sure you remember it and keep it secret"})]})]}),Object(R.jsxs)("div",{className:"pure-control-group",children:[Object(R.jsx)("input",{name:"pinConfirm",value:c.confirmPinValue.get(),onChange:function(e){var t=e.target.value;c.merge((function(e){return{confirmMatch:t===e.pinValue,confirmPinValue:t}}))},placeholder:"Confirm your PIN",className:"w-full",required:!0}),!c.confirmMatch.get()&&Object(R.jsx)("span",{className:"pure-form-message text-red-500",children:"Pins don't match"})]}),Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full",disabled:r,children:"Submit"})]})})})]})}function z(e){var t=e.children,n=Object(l.g)(),c=Object(l.f)(),r=b("pk-initialized"),i=Object(a.a)(r,1)[0],o=null!==i,u="NOT_READY"===i;return Object(s.useEffect)((function(){u||o||"/"===n.pathname||c.push("/")}),[n,c,u,o]),u?null:o?t:Object(R.jsx)(W,{})}var _=n(75),H=n(127),Y=n(270);var J=n(13);function q(){var e=Object(l.f)();return Object(R.jsxs)("div",{className:"my-2",children:[Object(R.jsx)("div",{className:"flex justify-center",children:Object(R.jsx)("img",{src:T,alt:"enigma"})}),Object(R.jsxs)("div",{className:"flex flex-wrap justify-center pt-2",children:[Object(R.jsx)(G,{text:"Home",to:"/"}),Object(R.jsx)(G,{text:"Contacts",to:"/contacts"}),Object(R.jsx)("div",{className:"pl-3",children:Object(R.jsx)("button",{className:"mx-1 text-center bg-black p-2 rounded text-white",onClick:function(t){t.preventDefault(),e.push("/unlock"),setTimeout(M,50)},children:"Lock"})})]})]})}function G(e){var t=e.text,n=e.to;return Object(R.jsx)(J.b,{to:n,children:Object(R.jsx)("button",{className:"mx-1 text-center bg-black p-2 rounded text-white",children:t})})}function Q(e){var t=e.children,n=function(){var e=Object(l.f)(),t=Object(l.g)(),n=C().publicKey,c=Object(s.useState)(!1),r=Object(a.a)(c,2),i=r[0],o=r[1],u=Object(Y.a)(12e4);return Object(s.useEffect)((function(){if(!n)return e.push("/unlock?redirectTo=".concat(t.pathname));o(!0)}),[n,o,e,t]),Object(s.useEffect)((function(){n&&u&&(e.push("/unlock?redirectTo=".concat(t.pathname)),setTimeout(M,50))}),[u,n,e,t.pathname]),i}();return Object(R.jsxs)("div",{children:[Object(R.jsx)("div",{children:Object(R.jsx)(q,{})}),Object(R.jsxs)("div",{className:"min-h-screen flex flex-col justify-between",children:[n&&Object(R.jsx)("div",{children:t}),Object(R.jsx)("div",{className:"text-center pt-4",children:"Don't be evil"})]})]})}function $(e){var t=e.children,n=Object(H.a)(e,["children"]);return Object(R.jsx)(l.a,Object(_.a)(Object(_.a)({},n),{},{children:Object(R.jsx)(z,{children:Object(R.jsx)(Q,{children:t})})}))}var X=n(18),Z=document.title;function ee(e){return e?"".concat(e," ").concat(Z):Z}function te(e){var t=e.children;return Object(R.jsxs)(X.b,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:Z})}),t]})}function ne(){return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:ee("About")})}),Object(R.jsx)(F,{})]})}function ce(e){var t=e.children;return Object(R.jsx)("div",{className:"p-4",children:t})}function re(e,t){var n=window.URL.createObjectURL(e),c=document.createElement("a");c.href=n,c.download=t,c.classList.add("hidden"),document.body.appendChild(c),c.click(),c.remove(),setTimeout((function(){window.URL.revokeObjectURL(e)}),1e3)}function ae(e){var t=Object(s.useState)(),n=Object(a.a)(t,2),c=n[0],r=n[1];Object(s.useEffect)((function(){S(e).then((function(e){r(e)}))}),[r,e]);return[c,function(t){r(t),P(e,t)}]}function se(){var e=ae("name"),t=Object(a.a)(e,1)[0],n=Object(d.c)({buttonDisabled:!1});function c(){return(c=Object(x.a)(O.a.mark((function e(c){var r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.preventDefault(),n.merge({buttonDisabled:!0}),e.next=4,K();case 4:r=e.sent,a=new Blob([JSON.stringify(r)]),s="".concat(t,"-enigma-backup.json"),re(a,s),n.merge({buttonDisabled:!1});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(R.jsxs)("div",{className:"mx-auto md:w-1/3 w-full",children:[Object(R.jsx)("div",{className:"py-4",children:Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){return c.apply(this,arguments)},disabled:n.buttonDisabled.get(),children:"Download backup"})}),Object(R.jsxs)("div",{children:[Object(R.jsx)("div",{className:"font-bold",children:"FAQ about backups"}),Object(R.jsx)(V,{title:"Can somebody restore my data with just the backup file?",children:"No, he needs the PIN"}),Object(R.jsxs)(V,{title:"What to do if someone got access to the program while it was PIN unlocked?",children:["Probably your ",Object(R.jsx)("a",{href:"https://en.wikipedia.org/wiki/Public-key_cryptography",target:"_blank",className:"underline",children:"Private Key"})," is compromised, you should start fresh and not from a backup."]})]})]})}function ie(e){var t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select();var n=document.execCommand("copy");return document.body.removeChild(t),n}function le(e){w.b.success(e)}function oe(e){for(var t,n,c,r="",a=e.length,s=0;s<a;s++)t||(n=1,c=10,t=Math.floor(Math.random()*(c-n+1))+n),r+=e[s],(t-=1)||(r+=" ");return r}var ue=n(269),de=function(){function e(t){var n=t.id,c=t.messageRaw,r=t.encryptedMessage,a=t.contact,s=t.createdAt,i=t.mine;Object(g.a)(this,e),this.id=n,this.messageRaw=c,this.encryptedMessage=r,this.contact=a,this.createdAt=s,this.mine=i}return Object(v.a)(e,[{key:"copyToClipBoard",value:function(){ie(oe(this.encryptedMessage)),le("Encrypted message copied to clipboard")}},{key:"save",value:function(){var e=Object(x.a)(O.a.mark((function e(){var t,n,c=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.contact.messages.set((function(e){return e.splice(0,0,c),e})),t="private-messages-".concat(this.contact.id.get()),e.next=4,S(t);case 4:n=e.sent,Object(m.isEmpty)(n)&&(n=[]),n.splice(0,0,this.serialize()),P(t,n);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){return{createdAt:this.createdAt,encryptedMessage:this.encryptedMessage.substring(0,8),id:this.id,messageRaw:this.messageRaw,mine:this.mine}}},{key:"destroy",value:function(){var e=Object(x.a)(O.a.mark((function e(t){var n,c,r,a=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.messages.findIndex((function(e){return e.id.get()===a.id})),c="private-messages-".concat(t.id.get()),e.next=4,S(c);case 4:r=(r=e.sent).filter((function(e){return e.id!==a.id})),t.messages.merge(Object(o.a)({},n,d.b)),P(c,r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function je(e,t,n){return be.apply(this,arguments)}function be(){return(be=Object(x.a)(O.a.mark((function e(t,n,c){var r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new Date).toISOString(),a=Object(ue.a)(),!0,s=new de({contact:c,createdAt:r,encryptedMessage:n,id:a,messageRaw:t,mine:true}),e.next=6,s.save();case 6:return e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,t,n){return me.apply(this,arguments)}function me(){return(me=Object(x.a)(O.a.mark((function e(t,n,c){var r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new Date).toISOString(),a=Object(ue.a)(),!1,s=new de({contact:c,createdAt:r,encryptedMessage:n,id:a,messageRaw:t,mine:false}),e.next=6,s.save();case 6:return e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return fe.apply(this,arguments)}function fe(){return(fe=Object(x.a)(O.a.mark((function e(t){var n,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="private-messages-".concat(t.id),e.next=3,S(n);case 3:if(c=e.sent,!Object(m.isEmpty)(c)){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",c.map((function(e){var n=new de(e);return n.contact=t,n})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe,xe=function(){function e(t){var n=t.id,c=t.name,r=t.emailHash,a=t.publicKey;Object(g.a)(this,e),this.id=n,this.name=c,this.emailHash=r,this.publicKey=a,this.messages=[]}return Object(v.a)(e,[{key:"save",value:function(){return e=this,void S("contacts").then((function(t){Object(m.isEmpty)(t)&&(t=[]);var n=t.find((function(t){return t.publicKey===e.publicKey}));n?(Object.assign(n,e.serializeWithoutId()),ge.contacts.find((function(t){return t.publicKey.get()===e.publicKey})).merge(e.serializeWithoutId())):(ge.contacts.set((function(t){return t.splice(0,0,e),t})),t.splice(0,0,e.serialize())),P("contacts",t)}));var e}},{key:"destroy",value:function(){return function(e){return ve.apply(this,arguments)}(this)}},{key:"serialize",value:function(){return{emailHash:this.emailHash,id:this.id,name:this.name,publicKey:this.publicKey}}},{key:"serializeWithoutId",value:function(){var e=this.serialize();return delete e.id,e}},{key:"loadPrivateMessages",value:function(){var e=Object(x.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.messages,e.next=3,he(this);case 3:e.t1=e.sent,e.t0.set.call(e.t0,e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ge=Object(d.a)({contacts:[]});function ve(){return(ve=Object(x.a)(O.a.mark((function e(t){var n,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S("contacts");case 2:if(n=e.sent,!Object(m.isEmpty)(n)){e.next=5;break}return e.abrupt("return");case 5:return n=n.filter((function(e){return e.publicKey!==t.publicKey})),void 0!==(c=ge.contacts.findIndex((function(e){return e.publicKey.get()===t.publicKey})))&&ge.contacts[c].set(d.b),e.next=10,P("contacts",n);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){return we.apply(this,arguments)}function we(){return(we=Object(x.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Oe){e.next=2;break}return e.abrupt("return",ge);case 2:return Oe=!0,e.next=5,S("contacts");case 5:if(t=e.sent,!Object(m.isEmpty)(t)){e.next=8;break}return e.abrupt("return",ge);case 8:return t=t.map((function(e){return new xe(e)})),n=Object(m.sortBy)(t,"name"),ge.merge({contacts:n}),e.abrupt("return",ge);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(){return(Ne=Object(x.a)(O.a.mark((function e(t){var n,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye();case 2:if(n=e.sent,(c=n.contacts.find((function(e){return e.id.get()===t}))).get()){e.next=6;break}return e.abrupt("return",{});case 6:return e.abrupt("return",new xe(JSON.parse(JSON.stringify(c.get()))));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ke=n.p+"static/media/user-placeholder.1bd594c3.svg";function Ee(e){var t=e.emailHash,n=e.contact,c=e.height,r=e.width,s=b("gravatar-enabled"),i=Object(a.a)(s,1)[0];if("NOT_READY"===i)return null;var l,o=t||n.emailHash.get();return l=Object(m.isEmpty)(o)||!i?ke:"http://www.gravatar.com/avatar/".concat(o),Object(R.jsx)("img",{src:l,className:"rounded-full ".concat(c," ").concat(r)})}function Ie(e){var t=e.contact,n=Object(d.c)({modalIsOpened:!1});function c(){n.merge({modalIsOpened:!1})}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("button",{className:"underline",onClick:function(e){e.preventDefault(),n.merge({modalIsOpened:!0})},children:"Edit"}),Object(R.jsx)(U,{isOpened:n.modalIsOpened.get(),close:c,children:Object(R.jsxs)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault(),c(),t.get().save(),le("Contact saved")},children:[Object(R.jsx)("fieldset",{children:Object(R.jsxs)("legend",{children:["Edit ",t.name.get()]})}),Object(R.jsx)("div",{className:"pure-control-group",children:Object(R.jsx)("input",{name:"name",value:t.name.get(),onChange:function(e){t.merge({name:e.target.value})},placeholder:"Name",className:"w-full",required:!0})}),Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full bg-black",children:"Save"})]})})]})}var Ce,Se=n(27),Pe=n(19);function De(e){if(!Object(m.isEmpty)(e))return Object(Pe.encodeBase64)(e).replace(/=/g,"")}function Ke(){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(m.isEmpty)(Ce)){e.next=2;break}return e.abrupt("return",Ce);case 2:return e.next=4,S("key-pair");case 4:if(t=e.sent,!Object(m.isEmpty)(t)){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",Ce=Uint8Array.from(t.secretKey));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e,t){return Re.apply(this,arguments)}function Re(){return(Re=Object(x.a)(O.a.mark((function e(t,n){var c,r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object(Pe.decodeBase64)(t),r=Object(Pe.decodeUTF8)(n),a=Object(p.randomBytes)(p.box.nonceLength),e.t0=p.box,e.t1=r,e.t2=a,e.t3=c,e.next=9,Ke();case 9:return e.t4=e.sent,s=(0,e.t0)(e.t1,e.t2,e.t3,e.t4),e.abrupt("return",De(s)+Ve(a));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){return Object(m.sample)(["?","!",".",","])+De(e)}function Fe(e){var t=e.contact,n=Object(s.useRef)(),c=Object(d.c)({modalIsOpened:!1});Object(s.useEffect)((function(){c.modalIsOpened.get()&&n.current.focus()}),[c.modalIsOpened.get()]);var r=Object(s.useState)((function(){return Se.EditorState.createEmpty()})),i=Object(a.a)(r,2),l=i[0],o=i[1];function u(){return(u=Object(x.a)(O.a.mark((function e(n){var r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r=(r=Object(Se.convertToRaw)(l.getCurrentContent())).blocks.map((function(e){return e.text.trim()?e.text:"\n"})).join("\n"),e.next=5,Me(t.publicKey.get(),r);case 5:return a=e.sent,e.next=8,je(r,a,t);case 8:s=e.sent,c.merge({modalIsOpened:!1}),o(Se.EditorState.createEmpty()),s.copyToClipBoard();case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){e.preventDefault(),c.merge({modalIsOpened:!0})},children:"Encrypt message"}),Object(R.jsx)(U,{isOpened:c.modalIsOpened.get(),close:function(){c.merge({modalIsOpened:!1})},children:Object(R.jsxs)("form",{onSubmit:function(e){return u.apply(this,arguments)},children:[Object(R.jsx)("div",{className:"border-gray-300 border border-solid p-2",children:Object(R.jsx)(Se.Editor,{editorState:l,onChange:o,placeholder:"Type your message",ref:n})}),Object(R.jsx)("div",{className:"flex justify-end my-2",children:Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary bg-black",disabled:!l.getCurrentContent().hasText(),children:"Encrypt message"})})]})})]})}function Te(e){return e.length%4!==0&&(e+="===".slice(0,4-e.length%4)),Object(Pe.decodeBase64)(e)}function Be(e,t){return Le.apply(this,arguments)}function Le(){return(Le=Object(x.a)(O.a.mark((function e(t,n){var c,r,s,i,l,o,u,d;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.split(/\?|!|\.|,/),r=Object(a.a)(c,2),s=r[0],i=r[1],!Object(m.isEmpty)(s)&&!Object(m.isEmpty)(i)){e.next=3;break}throw new Error("Invalid encrypted message");case 3:return l=Object(Pe.decodeBase64)(t),o=Te(i),u=Te(s),e.t0=p.box,e.t1=u,e.t2=o,e.t3=l,e.next=12,Ke();case 12:return e.t4=e.sent,d=e.t0.open.call(e.t0,e.t1,e.t2,e.t3,e.t4),e.abrupt("return",Object(Pe.encodeUTF8)(d));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){var t=e.contact,n=Object(s.useRef)(),c=Object(d.c)({modalIsOpened:!1});Object(s.useEffect)((function(){c.modalIsOpened.get()&&n.current.focus()}),[c.modalIsOpened.get()]);var r=Object(s.useState)((function(){return Se.EditorState.createEmpty()})),i=Object(a.a)(r,2),l=i[0],o=i[1];function u(){return(u=Object(x.a)(O.a.mark((function e(n){var r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r=(r=Object(Se.convertToRaw)(l.getCurrentContent())).blocks.map((function(e){return e.text.trim()?e.text:"\n"})).join("").replace(/\s/g,""),e.prev=3,e.next=6,Be(t.publicKey.get(),r);case 6:a=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",N("Invalid encrypted message"));case 12:return e.next=14,pe(a,r,t);case 14:c.merge({modalIsOpened:!1}),o(Se.EditorState.createEmpty()),le("Message decrypted!");case 17:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){e.preventDefault(),c.merge({modalIsOpened:!0})},children:"Decrypt message"}),Object(R.jsx)(U,{isOpened:c.modalIsOpened.get(),close:function(){c.merge({modalIsOpened:!1})},children:Object(R.jsxs)("form",{onSubmit:function(e){return u.apply(this,arguments)},children:[Object(R.jsx)("div",{className:"border-gray-300 border border-solid p-2",children:Object(R.jsx)(Se.Editor,{editorState:l,onChange:o,placeholder:"Paste the encrypted message",ref:n})}),Object(R.jsx)("div",{className:"flex justify-end my-2",children:Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary pure-button-primary bg-black",disabled:!l.getCurrentContent().hasText(),children:"Decrypt message"})})]})})]})}function We(e,t){return ze.apply(this,arguments)}function ze(){return(ze=Object(x.a)(O.a.mark((function e(t,n){var c,r,s,i,l,o,u,d;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.name.match(/-(.*)\.txt$/),!Object(m.isEmpty)(c)){e.next=3;break}throw new Error("Invalid encrypted file");case 3:return r=Object(a.a)(c,2),s=r[0],i=r[1],l=Te(n.name.replace(s,"")),o=Object(Pe.decodeBase64)(t),e.t0=p.box,e.t1=Uint8Array,e.next=10,n.arrayBuffer();case 10:return e.t2=e.sent,e.t3=new e.t1(e.t2),e.t4=l,e.t5=o,e.next=16,Ke();case 16:return e.t6=e.sent,u=e.t0.open.call(e.t0,e.t3,e.t4,e.t5,e.t6),d=new Blob([u],{type:"application/octet-stream"}),e.abrupt("return",{decryptedFile:d,fileName:"".concat(Object(ue.a)(),".").concat(i)});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e){var t=e.contact,n=Object(s.useRef)(),c=Object(d.c)({fileProcessing:!1,modalIsOpened:!1});function r(){return(r=Object(x.a)(O.a.mark((function e(n){var r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),c.merge({fileProcessing:!0}),e.prev=2,e.next=5,We(t.publicKey.get(),n.target.files[0]);case 5:r=e.sent,a=r.decryptedFile,s=r.fileName,re(a,s),e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(2),n.target.value="",c.merge({fileProcessing:!1}),e.abrupt("return",N("Unable to decrypt file"));case 16:n.target.value="",c.merge({fileProcessing:!1,modalIsOpened:!1}),le("File ready");case 19:case"end":return e.stop()}}),e,null,[[2,11]])})))).apply(this,arguments)}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){e.preventDefault(),c.merge({modalIsOpened:!0})},children:"Decrypt file"}),Object(R.jsxs)(U,{isOpened:c.modalIsOpened.get(),close:function(){c.fileProcessing.get()||c.merge({modalIsOpened:!1})},children:[Object(R.jsx)("input",{type:"file",className:"hidden",ref:n,onChange:function(e){return r.apply(this,arguments)}}),Object(R.jsx)("div",{className:"my-1",children:"As soon as the file is decrypted, you can download it"}),Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){e.preventDefault(),n.current.click()},disabled:c.fileProcessing.get(),children:"Select encrypted file"})]})]})}function He(e,t){return Ye.apply(this,arguments)}function Ye(){return(Ye=Object(x.a)(O.a.mark((function e(t,n){var c,r,a,s,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=Object(p.randomBytes)(p.box.nonceLength),r=Object(Pe.decodeBase64)(t),e.t0=p.box,e.t1=Uint8Array,e.next=6,n.arrayBuffer();case 6:return e.t2=e.sent,e.t3=new e.t1(e.t2),e.t4=c,e.t5=r,e.next=12,Ke();case 12:return e.t6=e.sent,a=(0,e.t0)(e.t3,e.t4,e.t5,e.t6),s=new Blob([a],{type:"application/octet-stream"}),i=n.name.split(".").pop(),e.abrupt("return",{fileName:"".concat(De(c),"-").concat(i,".txt"),outputFile:s});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Je(e){var t=e.contact,n=Object(s.useRef)(),c=Object(d.c)({fileProcessing:!1,modalIsOpened:!1});function r(){return(r=Object(x.a)(O.a.mark((function e(n){var r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),c.merge({fileProcessing:!0}),e.next=4,He(t.publicKey.get(),n.target.files[0]);case 4:r=e.sent,a=r.outputFile,s=r.fileName,n.target.value="",re(a,s),c.merge({fileProcessing:!1,modalIsOpened:!1}),le("File encrypted");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){e.preventDefault(),c.merge({modalIsOpened:!0})},children:"Encrypt file"}),Object(R.jsxs)(U,{isOpened:c.modalIsOpened.get(),close:function(){c.fileProcessing.get()||c.merge({modalIsOpened:!1})},children:[Object(R.jsx)("input",{type:"file",className:"hidden",ref:n,onChange:function(e){return r.apply(this,arguments)}}),Object(R.jsxs)("div",{className:"my-1",children:["As soon as the file is encrypted you will download it, ",Object(R.jsx)("span",{className:"font-bold",children:"do not rename it"})]}),Object(R.jsx)("button",{className:"pure-button pure-button-primary bg-black w-full",onClick:function(e){e.preventDefault(),n.current.click()},disabled:c.fileProcessing.get(),children:"Select unencrypted file"})]})]})}function qe(){for(var e=[],t=arguments.length,n=new Array(t),c=0;c<t;c++)n[c]=arguments[c];return n.forEach((function(t){t&&t.split(/\s/g).forEach((function(t){t.length>0&&e.push(t)}))})),e.join(" ")}var Ge=n(125);function Qe(e){var t,n,c=e.message,r=e.contact,a=c.messageRaw,s=c.createdAt,i=c.mine,l=c.encryptedMessage;return i.get()?(t="justify-end pl-20",n="text-right"):(t="pr-20",n="bg-green-300"),Object(R.jsx)("div",{className:qe("flex",t),children:Object(R.jsxs)("div",{className:qe("whitespace-pre-wrap my-1 p-2 border border-solid border-gray-300 rounded break-all",n),children:[a.get(),Object(R.jsx)("div",{className:qe("pt-1"),children:Object(R.jsx)(Ge.a,{datetime:s.get()})}),Object(R.jsxs)("div",{className:"text-xs border-solid border-gray-300 border-t p-1",children:["#",l.get().substring(0,8),Object(R.jsx)("button",{className:"ml-1 text-red-500",onClick:function(e){e.preventDefault(),c.get().destroy(r),le("Message removed")},children:"(x)"})]})]})})}var $e,Xe=n(60),Ze=n.n(Xe);function et(e){var t=e.contact,n=Object(s.useRef)(null);return Object(s.useEffect)((function(){t.messages.length>0||t.get().loadPrivateMessages(t)}),[t.id.get()]),Object(R.jsxs)("div",{children:[Object(R.jsx)("div",{className:"text-lg italic",children:"Private messages"}),Object(R.jsxs)("div",{className:"py-2 flex justify-between",children:[Object(R.jsxs)("div",{className:"w-1/2 pr-1",children:[Object(R.jsx)(Ue,{contact:t}),Object(R.jsx)("div",{className:"pt-1",children:Object(R.jsx)(_e,{contact:t})})]}),Object(R.jsxs)("div",{className:"w-1/2 pl-1",children:[Object(R.jsx)(Fe,{contact:t}),Object(R.jsx)("div",{className:"pt-1",children:Object(R.jsx)(Je,{contact:t})})]})]}),Object(R.jsx)("div",{className:"scroll-container",ref:n,children:Object(R.jsx)(Ze.a,{viewportRef:n,items:t.messages,itemMinSize:20,children:function(e){return Object(R.jsx)("div",{className:"item",children:Object(R.jsx)(Qe,{message:e,contact:t})},e.id.get())}})})]})}function tt(){return Object(R.jsx)("div",{children:"public"})}function nt(){var e,t,n=Object(l.h)().id,c=Object(l.i)(),r=c.path,a=c.url,i=Object(d.c)({contact:null,ready:!1});Object(s.useEffect)((function(){(function(e){return Ne.apply(this,arguments)})(n).then((function(e){i.merge({contact:e,ready:!0})}))}),[n]);var o=i.contact,u=i.ready;return(null===o||void 0===o||null===(e=o.id)||void 0===e?void 0:e.get())||u.get()?(null===o||void 0===o||null===(t=o.id)||void 0===t?void 0:t.get())?Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:ee(o.name.get())})}),Object(R.jsx)("div",{className:"w-full md:w-1/3 mx-auto",children:Object(R.jsxs)("div",{children:[Object(R.jsx)("div",{className:"flex justify-center pb-2",children:Object(R.jsx)(Ee,{contact:o,height:"h-20",width:"w-20"})}),Object(R.jsxs)("div",{className:"flex flex-wrap justify-center items-center",children:[Object(R.jsx)("h1",{className:"text-right pr-1",children:o.name.get()}),Object(R.jsx)("div",{className:"pl-1",children:Object(R.jsx)(Ie,{contact:o})})]}),Object(R.jsxs)("div",{children:[Object(R.jsxs)("div",{className:"my-1 flex justify-center",children:[Object(R.jsx)("div",{className:"px-1 underline",children:Object(R.jsx)(J.b,{to:"".concat(a),children:"Private Messages"})}),Object(R.jsx)("div",{className:"px-1 underline",children:Object(R.jsx)(J.b,{to:"".concat(a,"/public-messages"),children:"Public Messages"})})]}),Object(R.jsxs)(l.c,{children:[Object(R.jsx)(l.a,{exact:!0,path:r,children:Object(R.jsx)(et,{contact:o})}),Object(R.jsx)(l.a,{path:"".concat(r,"/public-messages"),children:Object(R.jsx)(tt,{})})]})]})]})})]}):Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:ee("Contact not found")})}),Object(R.jsx)("div",{children:"Contact not found"})]}):null}function ct(){var e=Object(d.c)({inputPkNameEmail:"",modalOpened:!1});return Object(R.jsxs)("div",{children:[Object(R.jsx)("button",{className:"bg-black text-white p-3",onClick:function(t){t.preventDefault(),e.merge({modalOpened:!0})},children:"+ Add new contact"}),Object(R.jsx)(U,{isOpened:e.modalOpened.get(),close:function(){e.merge({modalOpened:!1})},children:Object(R.jsx)("form",{className:"pure-form pure-form-aligned",onSubmit:function(t){t.preventDefault(),function(e){var t=e.replace(/\s/g,"").split("."),n=Object(a.a)(t,3),c=n[0],r=n[1],s=n[2];r=atob(r),r=Object(m.isEmpty)(r)?"Unknown user":r,new xe({emailHash:s,id:Object(ue.a)(),name:r,publicKey:c}).save()}(e.inputPkNameEmail.get()),e.merge({inputPkNameEmail:"",modalOpened:!1})},children:Object(R.jsxs)("fieldset",{children:[Object(R.jsx)("legend",{children:"Contact public key, name and email hashed"}),Object(R.jsx)("div",{className:"pure-control-group",children:Object(R.jsx)("input",{name:"inputPkNameEmail",value:e.inputPkNameEmail.get(),onChange:function(t){var n=t.target.value;e.merge({inputPkNameEmail:n})},placeholder:"Paste the contact code",className:"w-full"})}),Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary bg-black w-full",disabled:Object(m.isEmpty)(e.inputPkNameEmail.get()),children:"Add"})]})})})]})}function rt(e){var t=e.contact;return Object(R.jsxs)("div",{className:"flex flex-wrap items-center justify-between p-2 bg-gray-300 my-2 rounded",children:[Object(R.jsx)("div",{children:Object(R.jsx)(J.b,{to:"/contacts/".concat(t.id.get()),children:Object(R.jsxs)("div",{className:"flex items-center",children:[Object(R.jsx)(Ee,{contact:t,height:"h-20",width:"w-20"}),Object(R.jsx)("span",{className:"pl-2",children:t.name.get()})]})})}),Object(R.jsx)("div",{children:Object(R.jsx)("button",{onClick:function(e){e.preventDefault(),t.get().destroy()},children:"Remove"})})]})}function at(){var e=Object(d.c)(ge),t=Object(s.useRef)(null);return Object(R.jsx)("div",{className:"scroll-container",ref:t,children:Object(R.jsx)(Ze.a,{viewportRef:t,items:e.contacts,itemMinSize:20,children:function(e){return Object(R.jsx)("div",{className:"item",children:Object(R.jsx)(rt,{contact:e})},e.id.get())}})})}function st(e){var t=e.children,n=Object(s.useState)(),c=Object(a.a)(n,2),r=c[0],i=c[1];return Object(s.useEffect)((function(){ye().then((function(e){i(e)}))}),[i]),r?t:null}function it(){var e=b("gravatar-enabled"),t=Object(a.a)(e,2),n=t[0],c=t[1],r=Object(d.c)({modalIsOpened:!1});if("NOT_READY"===n)return null;return Object(R.jsxs)("div",{children:[Object(R.jsxs)("div",{className:"flex items-center",children:[Object(R.jsx)("input",{type:"checkbox",checked:!!n,onChange:function(){c(!n)}}),Object(R.jsx)("span",{className:"ml-1",children:"Toggle gravatar"})]}),Object(R.jsx)("div",{className:"mt-1",children:Object(R.jsx)("button",{className:"underline",onClick:function(e){e.preventDefault(),r.merge({modalIsOpened:!0})},children:"Is gravatar safe?"})}),Object(R.jsx)(U,{isOpened:r.modalIsOpened.get(),close:function(){r.merge({modalIsOpened:!1})},children:Object(R.jsxs)("div",{children:[Object(R.jsx)("h1",{className:"text-xl font-bold",children:"Is gravatar safe?"}),Object(R.jsxs)("div",{children:["The short answer if you need 100% security is ",Object(R.jsx)("b",{children:"NO"}),"."]}),Object(R.jsxs)("div",{children:["Otherwise ",Object(R.jsx)("b",{children:"maybe"}),", because you get tracked by gravatar, but they store images for free. Depends on you if are going to accept that risk."]})]})})]})}function lt(){return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:ee("Contacts")})}),Object(R.jsxs)("div",{className:"w-full md:w-1/3 mx-auto pt-4",children:[Object(R.jsx)("h1",{className:"text-center text-2xl font-bold",children:"Contacts"}),Object(R.jsxs)("div",{className:"flex justify-between",children:[Object(R.jsx)(it,{}),Object(R.jsx)(ct,{})]}),Object(R.jsx)("div",{children:Object(R.jsx)(st,{children:Object(R.jsx)(at,{})})})]})]})}function ot(e){return Object(y.MD5)(e).toString()}function ut(){var e=ae("name"),t=Object(a.a)(e,2),n=t[0],c=t[1],r=ae("email"),s=Object(a.a)(r,2),i=s[0],l=s[1],o=Object(d.c)({modalIsOpened:!1});function u(){o.merge({modalIsOpened:!1})}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("button",{className:"underline",onClick:function(e){e.preventDefault(),o.merge({modalIsOpened:!0})},children:"Edit profile"}),Object(R.jsx)(U,{isOpened:o.modalIsOpened.get(),close:u,children:Object(R.jsxs)("form",{className:"pure-form pure-form-aligned",onSubmit:function(e){e.preventDefault(),u(),le("Profile saved")},children:[Object(R.jsxs)("fieldset",{children:[Object(R.jsx)("legend",{children:"Edit profile"}),Object(R.jsx)("div",{className:"flex justify-center",children:Object(R.jsx)(Ee,{emailHash:ot(i),height:"h-20",width:"w-20"})})]}),Object(R.jsx)("div",{className:"pure-control-group",children:Object(R.jsx)("input",{name:"name",value:n,onChange:function(e){c(e.target.value)},placeholder:"Name",className:"w-full",required:!0})}),Object(R.jsxs)("div",{className:"pure-control-group",children:[Object(R.jsx)("input",{name:"email",value:i,onChange:function(e){l(e.target.value)},placeholder:"Email(optional)",className:"w-full"}),Object(R.jsxs)("span",{className:"pure-form-message",children:["Only the email MD5 hash is shared, not your real email. A image can be set for this email on ",Object(R.jsx)("a",{className:"underline",href:"https://gravatar.com/",target:"_blank",children:"gravatar.com"})]})]}),Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full bg-black",children:"Save"})]})})]})}function dt(){var e,t=C().publicKey,n=De(t),c=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var c=Object(s.useState)({}),r=Object(a.a)(c,2),i=r[0],l=r[1];return Object(s.useEffect)((function(){var e=t.map(function(){var e=Object(x.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,S(t);case 3:return e.t1=e.sent,e.abrupt("return",{keyName:e.t0,value:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.all(e).then((function(e){var t={};e.forEach((function(e){t[e.keyName]=e.value})),l(t)}))}),[l,t]),i}("name","email"),r=c.name,i=c.email,l=r?De((e=r,(new TextEncoder).encode(e))):"",o=i?ot(i):"",u="".concat(n,".").concat(l,".").concat(o),j=Object(d.c)({showCopied:!1});if(Object(s.useEffect)((function(){return function(){$e&&clearTimeout($e)}}),[]),!n)return null;if(!r||!i)return null;return Object(R.jsx)("div",{className:"p-3",children:Object(R.jsxs)("button",{className:"text-center bg-gray-300 hover:bg-gray-200 rounded p-2 border border-solid border-gray-300",onClick:function(e){e.preventDefault(),ie(oe(u)),j.merge({showCopied:!0}),$e=setTimeout((function(){j.merge({showCopied:!1})}),1500)},children:[Object(R.jsx)("div",{className:"font-bold",children:"My public key, name and email hashed"}),Object(R.jsx)("div",{className:"break-all",children:j.showCopied.get()?"Copied":u}),Object(R.jsx)("div",{className:"text-right text-sm",children:"Click to copy"})]})})}function jt(){return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:ee("Home")})}),Object(R.jsxs)("div",{className:"mx-auto md:w-1/3 w-full my-2 flex justify-between",children:[Object(R.jsx)(J.b,{to:"/about",children:Object(R.jsx)("span",{className:"underline",children:"About"})}),Object(R.jsx)(ut,{}),Object(R.jsx)(J.b,{to:"/backup",children:Object(R.jsx)("span",{className:"underline",children:"Backup service"})})]}),Object(R.jsx)("div",{className:"flex justify-center",children:Object(R.jsx)(dt,{})})]})}function bt(){return Object(R.jsx)("div",{className:"text-center text-3xl font-bold",children:"Page not found"})}function pt(e){var t=e.children;return Object(R.jsx)(J.a,{children:t})}function mt(e){return new Promise((function(t){var n=new FileReader;n.onload=function(){var e=Object(x.a)(O.a.mark((function e(n){var c,r,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=JSON.parse(n.target.result),e.next=3,u.clear();case 3:for(a in r=[],c)s=c[a],r.push(u.setItem(a,s));return e.next=7,Promise.all(r);case 7:t();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readAsText(e)}))}function ht(){var e=Object(d.c)({backupValue:"",modalOpened:!1,pinValue:"",showError:!1}),t=Object(s.useState)(),n=Object(a.a)(t,2),c=n[0],r=n[1],i=Object(l.f)(),o=new URLSearchParams(Object(l.g)().search),u=C().setKeyPair;function j(){return(j=Object(x.a)(O.a.mark((function t(n){var r,a;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),r=o.get("redirectTo")||"/",D(e.pinValue.get()),t.prev=3,Object(m.isEmpty)(e.backupValue)){t.next=7;break}return t.next=7,mt(c);case 7:return t.next=9,S("key-pair");case 9:if(a=t.sent,!Object(m.isEmpty)(a)){t.next=12;break}return t.abrupt("return",e.merge({backupFile:null,backupValue:"",modalOpened:!1,pinValue:"",showError:!0}));case 12:u(a),i.push(r),t.next=19;break;case 16:return t.prev=16,t.t0=t.catch(3),t.abrupt("return",e.merge({backupFile:null,backupValue:"",modalOpened:!1,pinValue:"",showError:!0}));case 19:case"end":return t.stop()}}),t,null,[[3,16]])})))).apply(this,arguments)}return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(X.a,{children:Object(R.jsx)("title",{children:ee("Unlock")})}),Object(R.jsxs)("div",{className:"w-full md:w-1/3 mx-auto",children:[Object(R.jsx)("div",{className:"flex justify-center",children:Object(R.jsx)("img",{src:T,alt:"enigma"})}),Object(R.jsx)("form",{className:"pure-form",onSubmit:function(e){return j.apply(this,arguments)},children:Object(R.jsxs)("fieldset",{children:[Object(R.jsxs)("div",{className:"pure-control-group py-2",children:[Object(R.jsx)("input",{type:"password",value:e.pinValue.get(),onChange:function(t){var n=t.target.value;e.merge({pinValue:n})},className:"w-full",placeholder:"Enter your PIN to continue"}),e.showError.get()&&Object(R.jsx)("span",{className:"pure-form-message text-red-500",children:"Invalid PIN"})]}),Object(R.jsx)("button",{type:"submit",className:"pure-button pure-button-primary w-full bg-black font-bold",disabled:Object(m.isEmpty)(e.pinValue.get()),children:"Unlock"}),Object(R.jsxs)("div",{className:"pure-control-group pt-4",children:[Object(R.jsx)("div",{className:"flex justify-end",children:Object(R.jsx)("button",{onClick:function(t){t.preventDefault(),e.merge({modalOpened:!0})},className:"underline",children:"Restore from backup"})}),Object(R.jsxs)(U,{isOpened:e.modalOpened.get(),close:function(){e.merge({modalOpened:!1})},children:[Object(R.jsx)("h1",{className:"font-lg font-bold",children:"Restore from backup"}),Object(R.jsx)("p",{children:"Select a backup file:"}),Object(R.jsx)("input",{type:"file",accept:".json",value:e.backupValue.get(),onChange:function(t){var n=t.target.value;e.merge({backupValue:n}),r(t.target.files[0])}}),Object(R.jsxs)("div",{className:"pt-2",children:[Object(R.jsx)("span",{className:"font-bold",children:"Warning"}),", restoring data from a backup, ",Object(R.jsx)("em",{children:"will override the current data"}),Object(R.jsxs)("div",{children:["Make sure, that you have a ",Object(R.jsx)("b",{children:"backup of the current data"}),"."]}),Object(R.jsx)("div",{children:"If you have a backup, then it's safe."})]})]})]})]})})]})]})}function ft(){return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(te,{children:Object(R.jsx)(pt,{children:Object(R.jsx)(ce,{children:Object(R.jsxs)(l.c,{children:[Object(R.jsx)($,{path:"/",exact:!0,children:Object(R.jsx)(jt,{})}),Object(R.jsx)($,{path:"/about",children:Object(R.jsx)(ne,{})}),Object(R.jsx)($,{path:"/backup",children:Object(R.jsx)(se,{})}),Object(R.jsx)($,{path:"/contacts/:id",children:Object(R.jsx)(nt,{})}),Object(R.jsx)($,{path:"/contacts",children:Object(R.jsx)(lt,{})}),Object(R.jsx)(l.a,{path:"/unlock",children:Object(R.jsx)(z,{children:Object(R.jsx)(ht,{})})}),Object(R.jsx)(l.a,{path:"*",children:Object(R.jsx)(bt,{})})]})})})}),Object(R.jsx)(w.a,{})]})}var Ot=n(48),xt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,271)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),c(e),r(e),a(e),s(e)}))};n.n(Ot).a.render(Object(R.jsx)(i.a.StrictMode,{children:Object(R.jsx)(ft,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/enigma-reloaded",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/enigma-reloaded","/service-worker.js");c?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var c=n.headers.get("content-type");404===n.status||null!=c&&-1===c.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):r(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):r(t,e)}))}}(),xt()}},[[267,1,2]]]);
//# sourceMappingURL=main.10b72261.chunk.js.map